Spatio-Temporal Hierarchical Causal Models
Xintong Li1, Haoran Zhang1, Xiao Zhou2,3,4*
1School of Statistics, Renmin University of China Beijing, China
2Gaoling School of Artificial Intelligence, Renmin University of China Beijing, China
3Beijing Key Laboratory of Research on Large Models and Intelligent Governance
4Engineering Research Center of Next-Generation Intelligent Search and Recommendation, MOE
{lixintong, zhanghaoran1015, xiaozhou}@ruc.edu.cn
Abstract
The abundance of fine-grained spatio-temporal data, such as
traffic sensor networks, offers vast opportunities for scien-
tific discovery. However, inferring causal relationships from
such observational data remains challenging, particularly due
to unobserved confounders that are specific to units (e.g.,
geographical locations) yet influence outcomes over time.
Most existing methods for spatio-temporal causal inference
assume that all confounders are observed, an assumption
that is often violated in practice. In this paper, we introduce
Spatio-Temporal Hierarchical Causal Models (ST-HCMs), a
novel graphical framework that extends hierarchical causal
modeling to the spatio-temporal domain. At the core of our
approach is the Spatio-Temporal Collapse Theorem, which
shows that a complex ST-HCM converges to a simpler flat
causal model as the amount of subunit data increases. This
theoretical result enables a general procedure for causal iden-
tification, allowing ST-HCMs to recover causal effects even
in the presence of unobserved, time-invariant unit-level con-
founders, a scenario where standard non-hierarchical models
fail. We validate the effectiveness of our framework on both
synthetic and real-world datasets, demonstrating its potential
for robust causal inference in complex dynamic systems.
Code — https://github.com/CAMELLIAxt/ST-HCMs
1
Introduction
Fine-grained spatio-temporal data are becoming ubiquitous,
generated by sources ranging from satellite imagery in en-
vironmental science to sensor networks in urban planning
(Wang et al. 2018; Xu and Zhou 2024; Ali et al. 2024; Dong
et al. 2024; Li, Li, and Zhou 2025). Such data inherently pos-
sess a hierarchical structure, offering unprecedented oppor-
tunities to uncover causal mechanisms in complex dynamic
systems. However, reliable causal inference from observa-
tional data remains challenging (Hern´an and Robins 2010;
Reich et al. 2021), obscuring mechanistic insights and im-
peding accurate policy intervention predictions in complex
spatio-temporal systems like urban operations (Zhang and
Ning 2023; Dong, Zhang, and Zhang 2025; Xie et al. 2025a).
Consider the urban traffic system in Figure 1, where a city
is divided into several regions (units), and within each re-
gion, numerous sensors monitor traffic flow (outcome) on
*Corresponding author.
Unit 3
Unit 1
A1
T
Outcome
Treatment
Confounding
Causal Path
Y1
T
A3
Spatial Interaction
Yij;t
Aij;t
U1
?
Unit 2
A2
T
Y2
T
U2
Y3
?
T
A12;t
A1m;t
A11;t
T
U3
Hierarchy
U1
Fixed
Y11;t
Y12;t
Y1m;t
…
…
Unit 1 with m   Subunits.
Ui
m
Figure 1: An example of hierarchical causality in traffic.
specific road segments (subunits). A traffic accident (treat-
ment) can disrupt the flow, but a region’s unique characteris-
tics, such as its geographical layout and road network struc-
ture, serve as an unobserved confounder. This confounder
affects both the likelihood of accidents and typical traffic
patterns, making it difficult to disentangle the true causal ef-
fect of an accident from the region’s inherent characteris-
tics (Weinstein and Blei 2024; Clarke and Polselli 2025).
The problem is further compounded by temporal dynam-
ics and spatial spillovers from neighboring regions, which
introduces additional layers of complexity (Robins 1986;
Aronow and Samii 2017; Reich et al. 2021).
This hierarchical structure offers a powerful, yet often un-
derutilized, path forward. Standard analytical methods of-
ten bypass this structure, instead relying on the strong “no
unmeasured confounding” assumption (Hern´an and Robins
2006; Ali, Faruque, and Wang 2024; Oprescu et al. 2025),
which is untenable for complex systems like the one in Fig-
ure 1. While instrumental variables (IV) provide a theoreti-
cal alternative (Martinussen et al. 2017; Cheng et al. 2024),
finding a valid instrument that is both relevant and exoge-
nous is notoriously difficult in practice. Methods like fixed-
effect (FE) models do leverage within-unit variation (An-
arXiv:2511.20558v1  [stat.ML]  25 Nov 2025

grist and Pischke 2009; Jensen, Burroni, and Rattigan 2020),
but they typically impose restrictive parametric assumptions,
such as linearity, limiting their applicability.
In contrast, our approach builds on the key insight illus-
trated in Figure 1: we treat each unit as a local natural experi-
ment, enabling non-parametric estimation of region-specific
causal effects by analyzing the relationship between treat-
ments and subunit-level outcomes. This paper extends this
powerful principle to spatio-temporal settings, where such
effects are confounded not only by static heterogeneity but
also by dynamic evolution and spatial interactions.
While the idea of leveraging hierarchical structure for
causal inference has been explored in static settings (We-
instein and Blei 2024), its extension to the spatio-temporal
domain presents non-trivial. The introduction of time and
space creates two fundamental challenges: (1) dynamic
confounding, where the history of the system acts as a time-
varying confounder for future treatments and outcomes, and
(2) spatial confounding, where the states of neighboring
units interfere with each other’s causal processes. To ad-
dress these challenges, we introduce Spatio-Temporal Hi-
erarchical Causal Models (ST-HCMs), a novel graphical
framework that explicitly models these dependencies. The
core of our solution is a Spatio-Temporal Collapse Theo-
rem, which provides a theoretical guarantee that the com-
plex, dynamic ST-HCM mathematically converges to a sim-
pler, equivalent representation. This theorem is the key that
enables causal identification, allowing us to disentangle ef-
fects from the web of spatio-temporal confounding.
The contributions of this paper are as follows:
• Conceptually, we propose the first graphical frame-
work (ST-HCMs) for causal modeling of nested spatio-
temporal data, providing a formal formulation to reason
about causality within spatio-temporal systems.
• Theoretically, we prove a Spatio-Temporal Collapse
Theorem (Theorem 2) that guarantees a complex ST-
HCM converges to a simpler, equivalent model, which in
turn enables causal identification (Theorem 3,4) despite
unobserved confounders.
• Experimentally, we validate our framework through
extensive simulations, showing that it robustly recov-
ers causal effects despite unobserved confounders and
spatial spillovers. On a real-world dataset, we further
demonstrate that it substantially reduces the biases inher-
ent to traditional non-hierarchical models.
2
Preliminaries
Notation
Consider a system composed of N units, in-
dexed by i ∈{1, . . . , N}, observed over T discrete time
steps, indexed by t ∈{1, . . . , T}. Each unit i contains mi
subunits, indexed by j ∈{1, . . . , mi}. For simplicity, we
assume mi = m for all i. Let V be a finite index set for en-
dogenous variable types. This set is partitioned into subunit-
level variables S and unit-level variables U = V \ S.
We define the key variables as follows:
• Xv
ij,t: The value of a subunit-level variable v ∈S for
subunit j in unit i at time t.
Ui
Ai
Yi
Ui
Ui
Qa
i
mi
N
Aij
Yij
Q
yja
i
N
N
(a) Aggregated
(b) HCM
(c) Collapsed 
Figure 2: Hierarchy and Collapsing in HCMs.
• Xw
i,t: The value of a unit-level variable w ∈U for unit i
at time t.
• Xi,<t: The full history of all variables associated with
unit i prior to time t.
• N(i): The set of spatial neighbors of unit i.
• X: A generic state space. P(X) denotes the space of all
probability measures on X.
• Ui: A time-invariant, unobserved random variable repre-
senting the static latent properties of unit i.
• γv
i,t, ϵv
ij,t: Time-varying exogenous noise variables at the
unit and subunit levels, respectively.
Causal Graphical Models and HCMs
A Causal Graph-
ical Model (CGM) represents causal relationships as a Di-
rected Acyclic Graph (DAG), where nodes are variables and
directed edges denote causal effects. Interventions are de-
noted by the do-operator (Pearl 2009).
The static Hierarchical Causal Model (HCM) framework
(Weinstein and Blei 2024) is designed to overcome con-
founding in nested data. As illustrated in Figure 2(a), in a
standard aggregated view, an unobserved confounder Ui bi-
ases the estimated effect of treatment ¯Ai on outcome ¯Yi. The
key insight of HCM is to leverage the fine-grained subunit
data within each unit, as depicted in Figure 2(b). This hier-
archical structure enables a powerful identification strategy
known as collapsing. The procedure transforms the HCM
into an equivalent, flat causal graph (Figure 2(c)), where the
subunit-level causal mechanisms are succinctly captured by
new random variables, termed Q-variables (e.g., Qa
i , Qy|a
i
).
However, the static HCM is limited to cross-sectional set-
tings and does not account for temporal dynamics or spa-
tial dependencies, which are essential in spatio-temporal do-
mains. Our work extends this collapsing principle to the dy-
namic spatio-temporal domain.
3
Spatio-Temporal Hierarchical Causal
Models
In this section, we introduce our Spatio-Temporal Hierarchi-
cal Causal Model (ST-HCM) framework. To build intuition,
we first present a temporal extension of the static HCM, the
T-HCM. We then incorporate spatial dependencies to formu-
late the ST-HCM and present the convergence theorem.
3.1
A Temporal Extension: T-HCMs
Definition 1 (Temporal Hierarchical Structural Causal
Model (T-HSCM)). A T-HSCM, Mt−hscm, is defined by:
(1) a summary causal graph GT whose unrolling over

time yields a DAG; (2) a set of static exogenous variables
Ui ∼P(U); (3) sets of time-varying exogenous noises
{γv
i,t}, {ϵv
ij,t}; and (4) a set of deterministic mechanism
functions {f v}v∈V . The value of each endogenous variable
is generated as follows:
• For a subunit-level variable v ∈S:
xv
ij,t = f v(Ui, paU(xv
i,t), paS(xv
ij,t), Xi,<t, γv
i,t, ϵv
ij,t).
• For a unit-level variable w ∈U:
xw
i,t = f w(Ui, paU(xw
i,t),
{{xv′
ij,t}v′∈paS(w,t)}m
j=1, Xi,<t, γw
i,t),
where the mechanism f w is permutation-invariant with
respect to the subunit index j.
By integrating out the exogenous noises from the struc-
tural model, we obtain the T-HCGM. This graphical model
is described by stochastic mechanisms, centered on the dy-
namic evolution of Q-variables, which represent the condi-
tional distributions governing subunit-level phenomena.
Definition 2 (Temporal Hierarchical Causal Graphical
Model (T-HCGM)). A T-HCGM, Mt−hcgm, corresponding
to a T-HSCM, is characterized by a two-stage generative
process at each time step t:
1. Q-variable Evolution: A vector of Q-variables Qi,t is
generated for each unit i, conditional on its macro-
history: Qi,t
∼
p(qt|Ui, Si,<t) where Si,<t
=
(XU
i,<t, Qi,<t) is the macro-history.
2. Variable Generation: Endogenous variables are drawn
conditional on the current Q-variables and their history.
To prove the convergence of this model to a simpler, col-
lapsed representation, we require the following assumptions.
Assumption 1 (Mechanism Convergence). For any w ∈U,
its conditional distribution’s generating mechanism is con-
tinuous with respect to the empirical measure of its subunit-
level parent histories. Let Pi,<t be the true probability mea-
sure on the subunit history space, determined by the macro-
history Histcol
i,<t = (Ui, Si,<t). Let ˆPi,m,<t be the empirical
measure from m subunits. We assume:
lim
m→∞E ˆ
Pi,m,<t[KL(p(Xw
i,t|Si,<t, Pi,<t)
|| p(Xw
i,t|Si,<t, ˆPi,m,<t))] = 0.
(1)
This assumption formalizes the idea that with enough sub-
unit data, the uncertainty from sampling subunit histories be-
comes negligible for determining unit-level outcomes .
Assumption 2 (Regularity of State Spaces). The state
spaces for all variables are Polish spaces. Furthermore,
the class of functions defining subunit histories forms a
Glivenko-Cantelli class, ensuring the uniform convergence
of empirical measures.
This is a standard technical condition for ensuring the reg-
ularity of the underlying probability spaces
(Hern´an and
Robins 2006; Ali, Faruque, and Wang 2024).
Theorem 1 (Convergence of T-HCMs). Under Assumptions
1 and 2, as the number of subunits m →∞, the joint distri-
bution of the macro-state history from a T-HCGM, marginal-
ized over subunit variables (P marg
m,T ), converges in Kullback-
Leibler divergence to the distribution of its corresponding
Dynamic Collapsed Model (Pcol,T ). For any finite time T:
lim
m→∞KL(Pcol,T || P marg
m,T ) = 0.
(2)
Proof Sketch. The proof proceeds by mathematical induc-
tion on the time step t, using the chain rule: KL(Pt||Qt) =
KL(Pt−1||Qt−1)+EPt−1[KL(P(St|Ht−1)||Q(St|Ht−1))].
The inductive step shows that the expected KL-divergence
of the one-step transition kernels converges to zero. We de-
compose this inner KL term into two parts: one for the Q-
variable evolution and one for the unit-level variable gener-
ation. The KL-divergence for the Q-variable part is identi-
cally zero by definition, as the collapsed model preserves
this mechanism exactly. The KL-divergence for the unit-
level variable part converges to zero due to a continuous
mapping argument: Assumption 2 ensures the convergence
of the input, and Assumption 1 ensures the continuity of the
function. Thus, the output distributions converge. The full
proof is provided in Appendix A.
3.2
The Framework: ST-HCMs
We now incorporate spatial dependencies to construct the
full Spatio-Temporal Hierarchical Causal Model. This intro-
duces new challenges, primarily the symmetric, contempo-
raneous interactions between units, which can create cycles
in the causal graph. We address this by imposing a causal
ordering on spatial interactions.
Definition 3 (Spatio-Temporal Hierarchical Causal Graph-
ical Model (ST-HCGM)). An ST-HCGM, Mst−hcgm, ex-
tends the T-HCGM by allowing the generating mechanisms
to depend on the states of spatial neighbors N(i).
• The Q-variable evolution for unit i now depends on its
own macro-history and that of its neighbors:
Qi,t ∼p(qt|Ui, Si,<t, {Sk,<t}k∈N (i)).
(3)
• The generation of unit-level variables Xw
i,t similarly de-
pends on the history of unit i and its neighbors N(i).
To ensure the model is well-defined, we introduce the fol-
lowing assumptions regarding its spatial structure.
Assumption 3 (Spatial Markov Property (S1)). The state of
any unit i at time t is conditionally independent of all non-
neighboring units, given the history of unit i and its desig-
nated neighbors N(i).
Assumption 4 (Spatial Causal Ordering (S2)). There ex-
ists a known, global ordering < on the set of all units
{1, . . . , N}. For any two neighbors i, j ∈N(i), contem-
poraneous causal influence is unidirectional: unit j can in-
fluence unit i at time t only if j < i.
Assumption 5 (Spatial Homogeneity (S3)). All units share
the same set of mechanism functions {f v}. The functional
form of spatial influence is invariant across space, depend-
ing only on the relative relationship between units, not their
absolute identities .

Ui
Spatial Interaction
Aij;t
Time Feedback
Yij;t
Static Confounding
Yij;t¡1
Aij;t¡1
Uk
Akj;t
Ykj;t
Akj;t¡1
Ykj;t¡1
i < k 2 fNg
Figure 3: The challenge of identifiability.
With these assumptions in place, we can state the main
convergence theorem for our full framework.
Theorem 2 (Convergence of ST-HCMs). Under Assump-
tions 1, 2, and 3-5, as the number of subunits m →∞,
the joint distribution of the macro-state history from an ST-
HCGM, marginalized over subunit variables (P marg
m,T,N), con-
verges in Kullback-Leibler divergence to the distribution
of its corresponding Spatio-Temporal Dynamic Collapsed
Model (Pcol,T,N). For any finite N and T:
lim
m→∞KL(Pcol,T,N || P marg
m,T,N) = 0.
(4)
Proof Sketch. We construct a single “Super-Unit” model,
Msuper, whose state at time t is the concatenated vec-
tor of states of all N spatial units, i.e., Ssuper,t
=
(S1,t, . . . , SN,t). Assumption 4 guarantees that the inter-
nal dependencies within this Super-Unit’s state vector at any
time t are acyclic. Consequently, Msuper is a valid (though
high-dimensional) T-HCM that satisfies all premises of The-
orem 1. Since the collapsing process for Msuper is mathe-
matically equivalent to the collapsing process for the origi-
nal ST-HCM, the convergence guaranteed by Theorem 1 for
Msuper directly implies the convergence for the ST-HCM.
The full proof is provided in Appendix B.
4
Identification and Estimation
Having established definition and convergence properties for
ST-HCMs, we now address its primary purpose: enabling
causal inference from spatio-temporal data. This section
tackles identifiability, determining when causal effects can
be uniquely computed from observational data. We develop
sufficient conditions for identifiability in ST-HCMs.
4.1
The Identifiability Problem in Dynamic
HCMs
The fundamental challenge of causal inference in dynamic
hierarchical systems is threefold (Figure 3). First, we face
unobserved unit-level confounding, represented by variable
Ui. Second, the system’s history acts as a confounder for
current treatments and future outcomes. Third, neighboring
units’ states can confound effects, creating spatial dependen-
cies that traditional methods cannot address.
Our goal is to identify the full post-intervention distribu-
tion P(Yk,t| do(Ai,t′ = a∗)), which describes the outcome
at a location k and time t under an intervention on a treat-
ment at location i and time t′. Thanks to the convergence
theorems (Theorems 1 and 2), this problem is equivalent
to identifying the effect in the corresponding Dynamic Col-
lapsed Model (DCM). Our identifiability results are derived
by analyzing the graphical structure of this DCM.
4.2
Identifiability via Sequential Adjustability
Our first identification strategy relies on the principle of ad-
justing for a sufficiently rich set of observed covariates to
block all backdoor paths between treatment and outcome.
We begin by stating the result for the purely temporal case,
which forms the foundation for the more general theorem.
Proposition 1 (Identifiability in T-HCMs via Adjustability).
In a T-HCGM satisfying the premises of Theorem 1, the
causal effect of a subunit-level treatment Aij,t′ on a future
outcome Yij,t (t ≥t′) is identifiable if, in its corresponding
DCM, all backdoor paths from the treatment node QA
i,t′ to
the outcome node QY
i,t are blocked by conditioning on the
observable macro-history Si,<t′.
Proof Sketch. The proof operates on the DCM. Condition-
ing on the observable history Si,<t′ blocks all confounding
paths originating from the system’s dynamic evolution. The
only remaining backdoor path is the static confounding path
QA
i,t′ ←Ui →QY
i,t. This path is resolved by the hierarchical
structure itself: we first estimate the conditional effect within
each unit i (where Ui is fixed), and then average these es-
timates across all units. This two-step procedure of sequen-
tial adjustment followed by hierarchical averaging allows for
identification. The full proof is in Appendix C.1.
This principle naturally extends to the full spatio-temporal
setting, where the adjustment set must also include the his-
tory of spatial neighbors.
Theorem 3 (Identifiability in ST-HCMs via Adjustability).
In an ST-HCGM satisfying the premises of Theorem 2, the
causal effect P(Yk,t| do(Ai,t′ = a∗)) is identifiable if, in its
ST-DCM, all backdoor paths from the treatment QA
i,t′ to the
outcome QY
k,t are blocked by conditioning on the observable
spatio-temporal history. This history comprises the macro-
states of unit i and its neighbors N(i) prior to time t′.
Proof Sketch. The logic directly parallels that of Proposi-
tion 1. The adjustment set is expanded to include the his-
tories of neighbors, {Sj,<t′}j∈N (i), to block confounding
paths that traverse space. After this spatio-temporal adjust-
ment, the remaining confounding is purely from the static,
unit-level variables {Uk}. As before, this static confounding
is handled by leveraging the subunit-level variation within
each unit to estimate conditional effects, which are then av-
eraged. The full proof is in Appendix C.3.
4.3
Identifiability via Dynamic Instruments
When a sufficiently rich history is not observable, we can
achieve identification by leveraging an exogenous source of
variation—an instrumental variable.
Proposition 2 (Identifiability in T-HCMs via Instruments).
In a T-HCGM, the causal effect of Aij,t′ on Yij,t is identi-
fiable if there exists a valid subunit-level instrumental vari-
able Zij,t′. A valid instrument must (1) be a cause of Aij,t′
(relevance) and (2) have no unblocked backdoor path to Yij,t
in the DCM that does not pass through Aij,t′.

Proof Sketch. A valid instrument Zij,t′ in the DCM, repre-
sented by QZ
i,t′, is d-separated from all confounders, includ-
ing the static Ui and any unobserved history. This allows us
to formulate a Fredholm integral equation of the first kind:
P(Yt|Zt′ = z) =
R
P(Yt| do(At′ = a))P(At′ = a|Zt′ =
z)da. Since the terms involving the observational distribu-
tion are identifiable, the causal effect P(Yt| do(At′ = a))
can be recovered by solving this integral equation. The full
proof is in Appendix C.2.
This result also generalizes to the spatio-temporal frame-
work, requiring a correspondingly stronger instrument.
Theorem 4 (Identifiability in ST-HCMs via Instruments). In
an ST-HCGM, the causal effect P(Yk,t| do(Ai,t′ = a∗)) is
identifiable if there exists a valid spatio-temporal subunit-
level instrumental variable Zij,t′. A valid instrument must
satisfy the exclusion restriction with respect to the entire sys-
tem: its node QZ
i,t′ in the ST-DCM must be d-separated from
all static confounders {Uk} and the complete, unobserved
history of the entire spatio-temporal system.
Proof Sketch. The proof is identical in structure to that of
Proposition 2. The instrument’s exogenous variation allows
us to establish the same integral equation relating the ob-
servational distribution to the desired causal effect. The key
difference lies in the strength of the required assumption:
the instrument must be exogenous not just to the history of
its own unit, but to the history of the entire interacting sys-
tem. Given such an instrument, identification follows. The
full proof is in Appendix C.4.
4.4
ATE with Time-Invariant Spatial
Confounding
To demonstrate our framework’s practical power, we focus
on a canonical yet challenging problem in real-world appli-
cations: estimating average treatment effects with unob-
served, time-invariant spatial confounding. This scenario
is particularly insightful because traditional spatio-temporal
methods often fail, while our hierarchical structure provides
a unique solution.
Problem Formulation
We consider an ST-HCM where
the primary challenge is an unobserved, time-invariant, unit-
level confounder, Ui. This confounder affects the treat-
ment assignment, outcomes, and potentially the dynamics
of neighboring units through spatial spillover, creating com-
plex confounding across both time and space.
Our goal is to identify and estimate the Average Treat-
ment Effect (ATE) of a global, static treatment policy.
Specifically, we are interested in the effect on the outcome at
a future time horizon T, resulting from setting the subunit-
level treatment A to a constant value a∗for all units i and all
time steps t ≤T. The formal estimand is:
ATET = E[YT |do(At = 1)] −E[YT |do(At = 0)],
(5)
where E[YT |do(At = a∗)] denotes the expected global av-
erage outcome at time T under the specified policy.
Identification Strategy
The identification of this ATE is
made possible by our theoretical framework, specifically by
applying Theorem 3. The strategy involves three concep-
tual steps: (1) collapsing the ST-HCM to its equivalent ST-
DCM, as guaranteed by Theorem 2; (2) applying a condi-
tional version of sequential adjustment on the ST-DCM; and
(3) leveraging the hierarchical structure to average out the
unobserved confounder Ui.
Assuming that the dynamic and spatial confounding paths
are blockable by the observable history (comprising the his-
tory of unit i and its neighbors N(i)), Theorem 3 ensures
that the ATE is identifiable. The identification formula can
be expressed as an expectation over the distribution of the
unobserved confounders U = (U1, ..., UN):
E[YT |do(At = a∗)] = EU [EG-Comp[YT |do(At = a∗), U]] .
The inner expectation, EG-Comp[·], represents the conditional
causal effect for units with fixed static properties U, which
can be computed via a recursive procedure analogous to
Robins’ G-Computation formula. The outer expectation,
EU[·], is then computed by averaging these conditional ef-
fects over the population of units.
Estimation Algorithm
We translate the identification
strategy into a practical, two-stage estimation algorithm.
Stage 1: Learning Conditional Dynamics.
For each unit
i, we estimate a unit-specific model, Mi, that captures the
full spatio-temporal dynamics conditional on its latent static
properties Ui. This model is trained on the subunit-level
panel data centered at unit i, including the histories of its
neighbors. The choice of model for Mi is flexible. Any
method capable of capturing the relevant temporal and spa-
tial dependencies can be employed, provided it can yield
an estimate of the conditional expectation of the outcome.
As our core contribution lies in the causal identification
framework itself, rather than a specific predictive model,
we prioritize methods that are well-established and inter-
pretable. Suitable candidates range from semi-parametric
models, such as Linear Mixed-Effects Models (LMM) ,
to non-parametric approaches like Gradient Boosting Ma-
chines (GBM). The specific implementation of Mi and fur-
ther details are provided in Appendix D.
Stage 2: Conditional G-Computation via Simulation.
With the trained models {Mi}N
i=1, we simulate the effect of
the intervention for each unit and then aggregate the results.
The procedure is detailed in Algorithm 1. For each unit i,
we recursively simulate the system’s evolution under a fixed
treatment policy a∗. At each time step t, the model Mi pre-
dicts the outcome ˆyi,t(a∗) based on the simulated history of
unit i and the observed history of its neighbors. The final
outcome at time T, ˆµi(T; a∗), represents an estimate of the
conditional causal effect for that unit. Finally, we average
these estimates across all units to obtain the ATE.
5
Experiments
We conduct experiments on both a synthetic setting and a
real-world case to evaluate ST-HCMs. We design 4 research
questions to guide the evaluation:

Algorithm 1: ATE Estimation in ST-HCM
1: Input: Spatio-temporal data D, time horizon T.
2: Output: Estimated Average Treatment Effect d
ATET .
3: Stage 1: Learning Conditional Dynamics
4: Train a set of unit-specific models {Mi}N
i=1 from D.
5: Stage 2: Simulation and Aggregation
6: Initialize result sets R0 ←∅, R1 ←∅.
7: for a∗∈{0, 1} do
8:
for i = 1 to N do
9:
Initialize simulation history Hi.
10:
for t = 1 to T do
11:
Get neighbors’ history HN(i),<t from D.
12:
Predict outcome ˆy(a∗)
i,t
←
Mi(do(At
=
a∗), Hi, HN(i),<t).
13:
Update Hi ←Hi ∪{(a∗, ˆy(a∗)
i,t )}.
14:
end for
15:
Add final outcome ˆy(a∗)
i,T
to result set Ra∗.
16:
end for
17: end for
18: Final Calculation
19: ˆE[YT |do(At = 1)] ←mean(R1).
20: ˆE[YT |do(At = 0)] ←mean(R0).
21: d
ATET ←ˆE[YT |do(At = 1)] −ˆE[YT |do(At = 0)].
22: return d
ATET
• RQ1 (Correctness) Can our method recover known
causal effects in an ideal synthetic setting?
• RQ2 (Superiority) How does our framework perform
compared to baselines that neglect either the hierarchical
structure or spatio-temporal dependencies of the data?
• RQ3 (Robustness) How robust is our method to viola-
tions of its key assumptions?
• RQ4 (Applicability) How sensitive are causal estimates
to underlying structural assumptions in a real-world sys-
tem, and how does ST-HCM address this challenge?
We implement our estimator with both parametric Linear
Mixed Models (LMM) (Faraway 2006) and non-parametric
Gradient Boosting Machines (GBM) models (Natekin and
Knoll 2013) to serve as the unit-specific conditional mech-
anism Mi. Full details of our experimental setup and data
generation processes are provided in Appendix E.
5.1
Simulation Experiments
Correctness
To verify the fundamental correctness of our
proposed estimation procedure, we first assess its ability to
produce unbiased and consistent estimates of the Average
Treatment Effect (ATE). We generate data from a canonical
spatio-temporal hierarchical process with a known true ATE.
Figure 4 demonstrates the statistical properties of our ST-
HCM estimator. The left panel shows the distribution of
ATE estimates over multiple independent trials. The mean
of this distribution (4.91) is nearly identical to the true ATE
(5.0), demonstrating that our estimator is unbiased. The
2
3
4
5
6
7
8
Average Treatment Effect
0.0
0.1
0.2
0.3
0.4
0.5
0.6
Density
ATE=5.0
ATE = 4.91
(a) Unbiasedness
10
20
50
100
200
500
Number of Subunits(m)
0.4
0.5
0.6
0.7
0.8
0.9
1.0
Absolute Estimation Error
Smoothed Trend
(b) Consistency
Figure 4: Validation of ST-HCM estimator.
right panel shows that the absolute estimation error con-
verges towards zero as the number of subunits per unit (m)
increases. This confirms the consistency of our estimator, a
key property guaranteed by our Collapse Theorem 2. These
results provide strong evidence that our framework is cor-
rectly specified and theoretically sound (answering RQ1).
Superiority over Baselines
Having established the cor-
rectness of our framework, we now conduct a rigorous stress
test to evaluate its superiority over several strong base-
lines in the presence of unobserved confounding and spatial
spillovers. To isolate the core causal identification capabil-
ities of each method, we instantiate our framework and the
hierarchical baselines using Linear Mixed Models (LMMs).
This creates a challenging but well-understood linear setting
where performance differences can be clearly attributed to
the structural assumptions of each model. We compare our
ST-HCM (LMM) against two primary classes of baselines:
1. Aggregated Models: A standard spatio-temporal LMM
applied to data aggregated at the unit-time level, which
ignores the hierarchical structure.
2. Non-Spatial Models: A Temporal HCM that models the
hierarchy but ignores spatial dependencies, equivalent to
a panel data model with fixed effects.
Table 1 presents the ATE absolute error for these models
across a wide grid of confounding strengths (γ) and spatial
spillover strengths (ρ). The results reveal two clear patterns.
First, hierarchy is essential for handling confounding.
Across all levels of spatial spillover (all row groups), the
error of the Aggregated model increases dramatically with
the confounding strength. In contrast, both hierarchical mod-
els (T-HCM and ST-HCM) maintain low error, demonstrat-
ing their robustness to the unobserved unit-level confounder
Ui. For instance, at ρ = 2.0 and γ = 4.0, the Aggregated
model’s error is 7.94, whereas the hierarchical models’ er-
rors are an order of magnitude smaller.
Second, spatial modeling is crucial under spillover.
While the T-HCM performs well when spillover is mild
(ρ = 0.0, 0.5), its error systematically increases as ρ grows.
Our proposed ST-HCM, which explicitly models these spa-
tial dependencies, consistently maintains the lowest error
across nearly all settings. At γ = 4.0, as ρ increases from 0.0
to 2.0, the error of the T-HCM explodes from 0.11 to 2.35,

Confounding Strength (γ)
ρ
Model
0.0
1.0
2.0
3.0
4.0
0.0
Aggregated
0.173
1.909
2.886
3.009
3.086
T-HCM
0.054
0.070
0.084
0.126
0.114
ST-HCM
0.057
0.073
0.086
0.118
0.117
0.5
Aggregated
0.164
1.854
3.038
3.387
3.785
T-HCM
0.097
0.068
0.072
0.128
0.080
ST-HCM
0.056
0.069
0.088
0.126
0.123
1.0
Aggregated
0.189
2.261
3.624
4.013
4.260
T-HCM
0.132
0.108
0.161
0.251
0.224
ST-HCM
0.056
0.066
0.076
0.127
0.121
1.5
Aggregated
0.211
3.420
5.051
5.950
6.734
T-HCM
0.174
0.135
0.335
0.507
0.606
ST-HCM
0.058
0.066
0.064
0.123
0.113
2.0
Aggregated
0.228
3.962
5.620
6.819
7.942
T-HCM
0.329
0.271
0.894
1.320
2.354
ST-HCM
0.056
0.072
0.070
0.124
0.110
Table 1: Mean ATE Absolute Error for different levels of
confounding strength (γ) and spatial spillover (ρ). Both T-
HCM (no spatial modeling) and ST-HCM (full model) are
proposed hierarchical estimators. T-HCM is optimal when
ρ = 0, while ST-HCM excels when ρ ≥1, demonstrating
the importance of correctly specifying spatial dependencies.
while our ST-HCM’s error remains stable at approximately
0.11. These findings indicate that our ST-HCM framework,
by correctly modeling both the hierarchical structure and
spatio-temporal dependencies, provides substantially more
accurate causal estimates than methods that ignore either di-
mension of the data’s complexity (answering RQ2).
Robustness
We assess the robustness of our ST-HCM
(LMM) estimator by systematically violating two key as-
sumptions: the time-invariance of the unobserved con-
founder and the causal ordering of spatial effects (Assump-
tion 4). Our simulations are based on a challenging linear
setting (N = 16, m = 50, T = 8) with fixed baseline con-
founding (γ = 2.0) and spatial spillover (ρ = 1.5). See
Appendix E for data generation details.
As illustrated in Figure 5, our proposed model demon-
strates considerable robustness. When the time-invariance
assumption is relaxed by introducing a temporal drift to the
confounder (Figure 5a), the error of our ST-HCM (LMM)
increases mildly but remains significantly lower than that of
the non-spatial T-HCM baseline. More impressively, when
the spatial ordering assumption is violated by introducing si-
multaneous feedback loops (Figure 5b), the performance of
our ST-HCM (LMM) remains nearly unaffected, maintain-
ing a consistently low error and substantially outperforming
both the T-HCM and Aggregated baselines across all viola-
tion intensities. This suggests our framework is a robust tool
for practical applications where these assumptions may not
strictly hold (answering RQ3).
4
5
6
7
8
0.0
0.1
0.2
0.3
0.4
0.5
0
1
2
Confounder Drift Strength
ATE Absolute Error
(a) Time-Variant Confounding
4.5
5.0
5.5
6.0
6.5
0.00
0.02
0.04
0.06
0.08
0.10
0.0
0.5
1.0
Cyclicity Strength
ATE Absolute Error
Aggregated
T-HCM
ST-HCM
(b) Violation of Spatial Order
Figure 5: Robustness analysis of estimators.
(a) Chicago Layout
(b) Estimated ATE Distributions
Figure 6: Real-world application.
5.2
Real-World Application: Urban Traffic
We demonstrate the applicability of our framework in real-
world using a Chicago traffic data set. Our analysis uses traf-
fic speed data from 1,025 road segments (subunits) across
29 traffic regions (units) over a one-week period, com-
prising over 1.2 million observations and 1943 treatment
events(Figure 6(a)).
To capture the complex non-linearities inherent in traffic
systems, we employ Gradient Boosting Machines (GBM) as
the implementation for the unit-specific conditional mecha-
nism Mi. We compare our full ST-HCM against a T-HCM
that ignores spatial effects, and an Aggregated model that
ignores the hierarchy entirely.
Results summarized in Figure 6(b) reveal that causal esti-
mates are sensitive to structural assumptions. Progressively
incorporating the hierarchical and then the spatial structure
systematically attenuates the estimated ATE. Notably, this
process also sharpens the posterior distribution, demonstrat-
ing that a more correctly specified model yields not only a
less biased but also a more precise estimate by disentangling
the treatment effect from unobserved confounders and spa-
tial spillovers (answering RQ4).
6
Related Work
Hierarchical causal models
The hierarchical causal
model framework (Weinstein and Blei 2024), exploits sub-
unit variation to address unobserved unit-level confounding,
generalizing fixed-effects and related econometric methods
(Gelman and Hill 2007; Wooldridge 2010). However, they

are designed for static i.i.d. settings and cannot capture
temporal or spatial dependencies. Recent advances such as
DML-panel methods with correlated random effects and dy-
namic multivariate panel models suggest possible extensions
toward temporal settings (Clarke and Polselli 2025; Tikka
and Helske 2024). Our ST-HCMs extend HCMs by explic-
itly modeling temporal dynamics and spatial interactions
while still addressing latent unit-level confounders.
Causal inference for spatio-temporal data
Existing ap-
proaches fall into two categories: (1) causal discovery meth-
ods that learn dynamic causal graphs from observational
data (Pamfil et al. 2020; Zhao et al. 2023; Gong et al. 2024;
Wang et al. 2025) (2) causal effect estimators that adapt
frameworks like G-computation, marginal structural models,
or propensity scores to dynamic or spatial settings, with re-
cent extensions using recurrent or transformer architectures
(Bica, Alaa, and van der Schaar 2020; Melnychuk, Frauen,
and Feuerriegel 2022; Bhattacharya and Sen 2024; Li et al.
2025; Oprescu et al. 2025). However, most assume no latent
unit-level confounders, which is unrealistic in domains like
environment or transportation. In contrast, ST-HCM address
this gap by structurally incorporating unobserved, static con-
founders, enabling more credible causal inference.
Panel data and IV-based causal inference
Panel meth-
ods such as fixed effects, difference-in-differences, and syn-
thetic control estimate effects via within-unit variation or
counterfactuals (Wooldridge 2010; Abadie, Diamond, and
Hainmueller 2010), but their i.i.d. and linearity assump-
tions limit use in spatio-temporal contexts (Millimet and
Bellemare 2023; Arkhangelsky and Imbens 2024). IV-based
approaches mitigate confounding, for example through
DeepIV and semiparametric IVs (Hartford et al. 2017; Xie
et al. 2025b; Cui et al. 2025); and the recent Time-dependent
Instrumental Factor Model (TIFM) addresses time-varying
confounders with learned substitutes (Cheng et al. 2024).
Still, IV methods hinge on valid instruments, which are of-
ten scarce in practice. Our ST-HCM offers a flexible alter-
native by combining hierarchical modeling with graphical
reasoning and spatio-temporal analysis.
7
Conclusion
In this paper, we introduced Spatio-Temporal Hierarchi-
cal Causal Models (ST-HCMs), a novel framework en-
abling reliable causal inference from nested spatio-temporal
data. Our theoretical foundation rests on a Spatio-Temporal
Collapse Theorem, guaranteeing that complex hierarchical
models converge to simpler, tractable counterparts, provid-
ing rigorous causal identification. Extensive experiments
verified this framework, demonstrating theoretical correct-
ness, practical necessity over baselines ignoring hierarchy
or spatial effects, and robustness to assumption violations.
8
Acknowledgements
We thank the reviewers for their valuable feedback. This
work was supported by Public Computing Cloud, Renmin
University of China and the fund for building world-class
universities (disciplines) of Renmin University of China.
References
Abadie, A.; Diamond, A.; and Hainmueller, J. 2010. Syn-
thetic control methods for comparative case studies: Esti-
mating the effect of California’s tobacco control program.
Journal of the American statistical Association, 105(490):
493–505.
Ali, S.; Faruque, O.; and Wang, J. 2024. Estimating direct
and indirect causal effects of spatiotemporal interventions
in presence of spatial interference. In Joint European Con-
ference on Machine Learning and Knowledge Discovery in
Databases, 213–230. Springer.
Ali, S.; Hasan, U.; Li, X.; Faruque, O.; Sampath, A.; Huang,
Y.; Gani, M. O.; and Wang, J. 2024. Causality for Earth Sci-
ence – A Review on Time-series and Spatiotemporal Causal-
ity Methods. arXiv:2404.05746.
Angrist, J. D.; and Pischke, J.-S. 2009.
Mostly harmless
econometrics: An empiricist’s companion. Princeton uni-
versity press.
Arkhangelsky, D.; and Imbens, G. 2024. Causal models for
longitudinal and panel data: a survey.
The Econometrics
Journal, 27(3): C1–C61.
Aronow, P. M.; and Samii, C. 2017.
Estimating average
causal effects under general interference, with application to
a social network experiment. The Annals of Applied Statis-
tics, 11(4): 1912 – 1947.
Bhattacharya, S.; and Sen, S. 2024. Causal effect estima-
tion under network interference with mean-field methods.
arXiv:2407.19613.
Bica, I.; Alaa, A. M.; and van der Schaar, M. 2020. Time Se-
ries Deconfounder: Estimating Treatment Effects over Time
in the Presence of Hidden Confounders. arXiv:1902.00450.
Billingsley, P. 1995. Probability and measure. A Wiley-
Interscience publication. New York [u.a.]: Wiley, 3. ed edi-
tion. ISBN 0471007102.
Cheng, D.; Xu, Z.; Li, J.; Liu, L.; Liu, J.; Gao, W.; and Le,
T. D. 2024. Instrumental variable estimation for causal in-
ference in longitudinal data with time-dependent latent con-
founders. In Proceedings of the AAAI Conference on Artifi-
cial Intelligence, volume 38, 11480–11488.
Clarke, P. S.; and Polselli, A. 2025. Double machine learn-
ing for static panel models with fixed effects. The Econo-
metrics Journal, utaf011.
Cover, T. M.; and Thomas, J. A. 1991. Elements of informa-
tion theory. Wiley series in telecommunications. New York,
NY [u.a.]: Wiley.
Cressie, N.; and Wikle, C. K. 2011. Statistics for Spatio-
Temporal Data. Wiley.
Cui, E. H.; Lu, X.; Zhou, J.; Zhou, H.; and Li, G. 2025. A
Semiparametric Bayesian Method for Instrumental Variable
Analysis with Partly Interval-Censored Time-to-Event Out-
come. arXiv:2501.14837.
Dong, P.; Wang, X.-L.; Bose, I.; Ng, K. K. H.; Zhang,
X.; and Zhang, X. 2024. Causally-Aware Spatio-Temporal
Multi-Graph Convolution Network for Accurate and Reli-
able Traffic Prediction. arXiv:2408.13293.

Dong, P.; Zhang, X.; and Zhang, X. 2025. A data-driven
approach for spatio-temporal causal analysis in large-scale
urban traffic networks. Transportation Research Part E: Lo-
gistics and Transportation Review, 202: 104244.
Dudley, R. M. 1999.
Uniform Central Limit Theorems.
Cambridge Studies in Advanced Mathematics. Cambridge
University Press.
Duvenaud, D. 2014.
Automatic model construction with
Gaussian processes.
Ph.D. thesis, Apollo - University of
Cambridge Repository.
Faraway, J. J. 2006. Extending Linear Models with R: Gen-
eralized Linear, Mixed Effects and Nonparametric Regres-
sion Models. Boca Raton, FL: Chapman & Hall/CRC. ISBN
1-584-88424-X.
Folland, G. 2013. Real Analysis: Modern Techniques and
Their Applications. Pure and Applied Mathematics: A Wi-
ley Series of Texts, Monographs and Tracts. Wiley. ISBN
9781118626399.
Gelfand, A.; Fuentes, M.; Guttorp, P.; and Diggle, P. 2010.
Handbook of Spatial Statistics.
Chapman & Hall/CRC
Handbooks of Modern Statistical Methods. Taylor & Fran-
cis. ISBN 9781420072877.
Gelman, A.; and Hill, J. 2007. Data analysis using regres-
sion and multilevel/hierarchical models. Cambridge univer-
sity press.
Gong, C.; Zhang, C.; Yao, D.; Bi, J.; Li, W.; and Xu, Y. 2024.
Causal discovery from temporal data: An overview and new
perspectives. ACM Computing Surveys, 57(4): 1–38.
Hartford, J.; Lewis, G.; Leyton-Brown, K.; and Taddy, M.
2017.
Deep IV: A Flexible Approach for Counterfactual
Prediction. In Precup, D.; and Teh, Y. W., eds., Proceedings
of the 34th International Conference on Machine Learning,
volume 70 of Proceedings of Machine Learning Research,
1414–1423. PMLR.
Hern´an, M. A.; and Robins, J. M. 2006. Estimating causal
effects from epidemiological data. Journal of Epidemiology
& Community Health, 60(7): 578–586.
Hern´an, M. A.; and Robins, J. M. 2010. Causal inference.
Jensen, D.; Burroni, J.; and Rattigan, M. 2020. Object Con-
ditioning for Causal Inference. In Adams, R. P.; and Gogate,
V., eds., Proceedings of The 35th Uncertainty in Artificial
Intelligence Conference, volume 115 of Proceedings of Ma-
chine Learning Research, 1072–1082. PMLR.
Kechris, A. 2012. Classical descriptive set theory, volume
156. Springer Science & Business Media.
Li, J.; Li, X.; and Zhou, X. 2025. FAP-CD: Fairness-Driven
Age-Friendly Community Planning via Conditional Diffu-
sion Generation. Proceedings of the AAAI Conference on
Artificial Intelligence, 39(27): 28168–28176.
Li, S.; Li, H.; Li, X.; Xu, Y.; Lin, Z.; and Jiang, H. 2025.
Causal Intervention Is What Large Language Models Need
for Spatio-Temporal Forecasting. IEEE Transactions on Cy-
bernetics, 55(8): 3825–3837.
Martinussen, T.; Vansteelandt, S.; Tchetgen Tchetgen, E. J.;
and Zucker, D. M. 2017. Instrumental variables estimation
of exposure effects on a time-to-event endpoint using struc-
tural cumulative survival models. Biometrics, 73(4): 1140–
1149.
Melnychuk, V.; Frauen, D.; and Feuerriegel, S. 2022.
Causal Transformer for Estimating Counterfactual Out-
comes. arXiv:2204.07258.
Millimet, D.; and Bellemare, M. F. 2023. Fixed effects and
causal inference.
Natekin, A.; and Knoll, A. 2013.
Gradient boosting ma-
chines, a tutorial. Frontiers in Neurorobotics, Volume 7 -
2013.
Newey, W. K.; and Powell, J. L. 2003. Instrumental variable
estimation of nonparametric models. Econometrica, 71(5):
1565–1578.
Oprescu, M.; Park, D. K.; Luo, X.; Yoo, S.; and Kallus,
N. 2025. GST-UNet: Spatiotemporal Causal Inference with
Time-Varying Confounders. arXiv:2502.05295.
Pamfil, R.; Sriwattanaworachai, N.; Desai, S.; Pilgerstor-
fer, P.; Beaumont, P.; Georgatzis, K.; and Aragam, B. 2020.
DYNOTEARS: Structure Learning from Time-Series Data.
arXiv:2002.00498.
Pearl, J. 2009. Causal inference in statistics: An overview.
Statistics Surveys, 3(none): 96 – 146.
Rasmussen, C. E.; and Williams, C. K. I. 2006. Gaussian
Processes for Machine Learning. MIT Press.
Reich, B. J.; Yang, S.; Guan, Y.; Giffin, A. B.; Miller, M. J.;
and Rappold, A. 2021.
A review of spatial causal infer-
ence methods for environmental and epidemiological appli-
cations. International Statistical Review, 89(3): 605–634.
Robins, J. 1986. A new approach to causal inference in mor-
tality studies with a sustained exposure period—application
to control of the healthy worker survivor effect. Mathemati-
cal Modelling, 7(9): 1393–1512.
Tikka, S.; and Helske, J. 2024. dynamite: An R Package for
Dynamic Multivariate Panel Models. arXiv:2302.01607.
Wang, K.; Varambally, S.; Watson-Parris, D.; Ma, Y.-A.; and
Yu, R. 2025. Discovering Latent Causal Graphs from Spa-
tiotemporal Data. arXiv:2411.05331.
Wang, Y.; Zhou, X.; Mascolo, C.; Noulas, A.; Xie, X.; and
Liu, Q. 2018. Predicting the Spatio-Temporal Evolution of
Chronic Diseases in Population with Human Mobility Data.
Weinstein, E. N.; and Blei, D. M. 2024. Hierarchical Causal
Models. arXiv:2401.05330.
Wooldridge, J. M. 2010. Econometric analysis of cross sec-
tion and panel data. MIT press.
Xie, Z.; Hong, Z.; Lyu, W.; Wang, H.; Wang, G.; and Zhang,
D. 2025a.
CoAlign: Uncertainty Calibration of LLM for
Geospatial Repartition. In Rehm, G.; and Li, Y., eds., Pro-
ceedings of the 63rd Annual Meeting of the Association for
Computational Linguistics (Volume 6: Industry Track), 254–
263. Vienna, Austria: Association for Computational Lin-
guistics. ISBN 979-8-89176-288-6.
Xie, Z.; Lyu, W.; Song, Y.; Wang, H.; Yang, G.; Liu, Y.; He,
T.; Zhang, D.; and Wang, G. 2025b. Scalable Area Diffi-
culty Assessment with Knowledge-enhanced AI for Nation-
wide Logistics Systems. In Proceedings of the 31st ACM

SIGKDD Conference on Knowledge Discovery and Data
Mining V.1, KDD ’25, 2713–2724. New York, NY, USA: As-
sociation for Computing Machinery. ISBN 9798400712456.
Xu, Z.; and Zhou, X. 2024. CGAP: Urban Region Repre-
sentation Learning with Coarsened Graph Attention Pool-
ing. arXiv:2407.02074.
Zhang, W.; and Ning, K. 2023.
Spatiotemporal hetero-
geneities in the causal effects of mobility intervention poli-
cies during the COVID-19 outbreak: A spatially interrupted
time-series (SITS) analysis. Annals of the American Associ-
ation of Geographers, 113(5): 1112–1134.
Zhao, W.; Zhang, S.; Wang, B.; and Zhou, B. 2023. Spatio-
temporal causal graph attention network for traffic flow pre-
diction in intelligent transportation systems.
PeerJ Com-
puter Science, 9: e1484.
References
Abadie, A.; Diamond, A.; and Hainmueller, J. 2010. Syn-
thetic control methods for comparative case studies: Esti-
mating the effect of California’s tobacco control program.
Journal of the American statistical Association, 105(490):
493–505.
Ali, S.; Faruque, O.; and Wang, J. 2024. Estimating direct
and indirect causal effects of spatiotemporal interventions
in presence of spatial interference. In Joint European Con-
ference on Machine Learning and Knowledge Discovery in
Databases, 213–230. Springer.
Ali, S.; Hasan, U.; Li, X.; Faruque, O.; Sampath, A.; Huang,
Y.; Gani, M. O.; and Wang, J. 2024. Causality for Earth Sci-
ence – A Review on Time-series and Spatiotemporal Causal-
ity Methods. arXiv:2404.05746.
Angrist, J. D.; and Pischke, J.-S. 2009.
Mostly harmless
econometrics: An empiricist’s companion. Princeton uni-
versity press.
Arkhangelsky, D.; and Imbens, G. 2024. Causal models for
longitudinal and panel data: a survey.
The Econometrics
Journal, 27(3): C1–C61.
Aronow, P. M.; and Samii, C. 2017.
Estimating average
causal effects under general interference, with application to
a social network experiment. The Annals of Applied Statis-
tics, 11(4): 1912 – 1947.
Bhattacharya, S.; and Sen, S. 2024. Causal effect estima-
tion under network interference with mean-field methods.
arXiv:2407.19613.
Bica, I.; Alaa, A. M.; and van der Schaar, M. 2020. Time Se-
ries Deconfounder: Estimating Treatment Effects over Time
in the Presence of Hidden Confounders. arXiv:1902.00450.
Billingsley, P. 1995. Probability and measure. A Wiley-
Interscience publication. New York [u.a.]: Wiley, 3. ed edi-
tion. ISBN 0471007102.
Cheng, D.; Xu, Z.; Li, J.; Liu, L.; Liu, J.; Gao, W.; and Le,
T. D. 2024. Instrumental variable estimation for causal in-
ference in longitudinal data with time-dependent latent con-
founders. In Proceedings of the AAAI Conference on Artifi-
cial Intelligence, volume 38, 11480–11488.
Clarke, P. S.; and Polselli, A. 2025. Double machine learn-
ing for static panel models with fixed effects. The Econo-
metrics Journal, utaf011.
Cover, T. M.; and Thomas, J. A. 1991. Elements of informa-
tion theory. Wiley series in telecommunications. New York,
NY [u.a.]: Wiley.
Cressie, N.; and Wikle, C. K. 2011. Statistics for Spatio-
Temporal Data. Wiley.
Cui, E. H.; Lu, X.; Zhou, J.; Zhou, H.; and Li, G. 2025. A
Semiparametric Bayesian Method for Instrumental Variable
Analysis with Partly Interval-Censored Time-to-Event Out-
come. arXiv:2501.14837.
Dong, P.; Wang, X.-L.; Bose, I.; Ng, K. K. H.; Zhang,
X.; and Zhang, X. 2024. Causally-Aware Spatio-Temporal
Multi-Graph Convolution Network for Accurate and Reli-
able Traffic Prediction. arXiv:2408.13293.
Dong, P.; Zhang, X.; and Zhang, X. 2025. A data-driven
approach for spatio-temporal causal analysis in large-scale
urban traffic networks. Transportation Research Part E: Lo-
gistics and Transportation Review, 202: 104244.
Dudley, R. M. 1999.
Uniform Central Limit Theorems.
Cambridge Studies in Advanced Mathematics. Cambridge
University Press.
Duvenaud, D. 2014.
Automatic model construction with
Gaussian processes.
Ph.D. thesis, Apollo - University of
Cambridge Repository.
Faraway, J. J. 2006. Extending Linear Models with R: Gen-
eralized Linear, Mixed Effects and Nonparametric Regres-
sion Models. Boca Raton, FL: Chapman & Hall/CRC. ISBN
1-584-88424-X.
Folland, G. 2013. Real Analysis: Modern Techniques and
Their Applications. Pure and Applied Mathematics: A Wi-
ley Series of Texts, Monographs and Tracts. Wiley. ISBN
9781118626399.
Gelfand, A.; Fuentes, M.; Guttorp, P.; and Diggle, P. 2010.
Handbook of Spatial Statistics.
Chapman & Hall/CRC
Handbooks of Modern Statistical Methods. Taylor & Fran-
cis. ISBN 9781420072877.
Gelman, A.; and Hill, J. 2007. Data analysis using regres-
sion and multilevel/hierarchical models. Cambridge univer-
sity press.
Gong, C.; Zhang, C.; Yao, D.; Bi, J.; Li, W.; and Xu, Y. 2024.
Causal discovery from temporal data: An overview and new
perspectives. ACM Computing Surveys, 57(4): 1–38.
Hartford, J.; Lewis, G.; Leyton-Brown, K.; and Taddy, M.
2017.
Deep IV: A Flexible Approach for Counterfactual
Prediction. In Precup, D.; and Teh, Y. W., eds., Proceedings
of the 34th International Conference on Machine Learning,
volume 70 of Proceedings of Machine Learning Research,
1414–1423. PMLR.
Hern´an, M. A.; and Robins, J. M. 2006. Estimating causal
effects from epidemiological data. Journal of Epidemiology
& Community Health, 60(7): 578–586.
Hern´an, M. A.; and Robins, J. M. 2010. Causal inference.

Jensen, D.; Burroni, J.; and Rattigan, M. 2020. Object Con-
ditioning for Causal Inference. In Adams, R. P.; and Gogate,
V., eds., Proceedings of The 35th Uncertainty in Artificial
Intelligence Conference, volume 115 of Proceedings of Ma-
chine Learning Research, 1072–1082. PMLR.
Kechris, A. 2012. Classical descriptive set theory, volume
156. Springer Science & Business Media.
Li, J.; Li, X.; and Zhou, X. 2025. FAP-CD: Fairness-Driven
Age-Friendly Community Planning via Conditional Diffu-
sion Generation. Proceedings of the AAAI Conference on
Artificial Intelligence, 39(27): 28168–28176.
Li, S.; Li, H.; Li, X.; Xu, Y.; Lin, Z.; and Jiang, H. 2025.
Causal Intervention Is What Large Language Models Need
for Spatio-Temporal Forecasting. IEEE Transactions on Cy-
bernetics, 55(8): 3825–3837.
Martinussen, T.; Vansteelandt, S.; Tchetgen Tchetgen, E. J.;
and Zucker, D. M. 2017. Instrumental variables estimation
of exposure effects on a time-to-event endpoint using struc-
tural cumulative survival models. Biometrics, 73(4): 1140–
1149.
Melnychuk, V.; Frauen, D.; and Feuerriegel, S. 2022.
Causal Transformer for Estimating Counterfactual Out-
comes. arXiv:2204.07258.
Millimet, D.; and Bellemare, M. F. 2023. Fixed effects and
causal inference.
Natekin, A.; and Knoll, A. 2013.
Gradient boosting ma-
chines, a tutorial. Frontiers in Neurorobotics, Volume 7 -
2013.
Newey, W. K.; and Powell, J. L. 2003. Instrumental variable
estimation of nonparametric models. Econometrica, 71(5):
1565–1578.
Oprescu, M.; Park, D. K.; Luo, X.; Yoo, S.; and Kallus,
N. 2025. GST-UNet: Spatiotemporal Causal Inference with
Time-Varying Confounders. arXiv:2502.05295.
Pamfil, R.; Sriwattanaworachai, N.; Desai, S.; Pilgerstor-
fer, P.; Beaumont, P.; Georgatzis, K.; and Aragam, B. 2020.
DYNOTEARS: Structure Learning from Time-Series Data.
arXiv:2002.00498.
Pearl, J. 2009. Causal inference in statistics: An overview.
Statistics Surveys, 3(none): 96 – 146.
Rasmussen, C. E.; and Williams, C. K. I. 2006. Gaussian
Processes for Machine Learning. MIT Press.
Reich, B. J.; Yang, S.; Guan, Y.; Giffin, A. B.; Miller, M. J.;
and Rappold, A. 2021.
A review of spatial causal infer-
ence methods for environmental and epidemiological appli-
cations. International Statistical Review, 89(3): 605–634.
Robins, J. 1986. A new approach to causal inference in mor-
tality studies with a sustained exposure period—application
to control of the healthy worker survivor effect. Mathemati-
cal Modelling, 7(9): 1393–1512.
Tikka, S.; and Helske, J. 2024. dynamite: An R Package for
Dynamic Multivariate Panel Models. arXiv:2302.01607.
Wang, K.; Varambally, S.; Watson-Parris, D.; Ma, Y.-A.; and
Yu, R. 2025. Discovering Latent Causal Graphs from Spa-
tiotemporal Data. arXiv:2411.05331.
Wang, Y.; Zhou, X.; Mascolo, C.; Noulas, A.; Xie, X.; and
Liu, Q. 2018. Predicting the Spatio-Temporal Evolution of
Chronic Diseases in Population with Human Mobility Data.
Weinstein, E. N.; and Blei, D. M. 2024. Hierarchical Causal
Models. arXiv:2401.05330.
Wooldridge, J. M. 2010. Econometric analysis of cross sec-
tion and panel data. MIT press.
Xie, Z.; Hong, Z.; Lyu, W.; Wang, H.; Wang, G.; and Zhang,
D. 2025a.
CoAlign: Uncertainty Calibration of LLM for
Geospatial Repartition. In Rehm, G.; and Li, Y., eds., Pro-
ceedings of the 63rd Annual Meeting of the Association for
Computational Linguistics (Volume 6: Industry Track), 254–
263. Vienna, Austria: Association for Computational Lin-
guistics. ISBN 979-8-89176-288-6.
Xie, Z.; Lyu, W.; Song, Y.; Wang, H.; Yang, G.; Liu, Y.; He,
T.; Zhang, D.; and Wang, G. 2025b. Scalable Area Diffi-
culty Assessment with Knowledge-enhanced AI for Nation-
wide Logistics Systems. In Proceedings of the 31st ACM
SIGKDD Conference on Knowledge Discovery and Data
Mining V.1, KDD ’25, 2713–2724. New York, NY, USA: As-
sociation for Computing Machinery. ISBN 9798400712456.
Xu, Z.; and Zhou, X. 2024. CGAP: Urban Region Repre-
sentation Learning with Coarsened Graph Attention Pool-
ing. arXiv:2407.02074.
Zhang, W.; and Ning, K. 2023.
Spatiotemporal hetero-
geneities in the causal effects of mobility intervention poli-
cies during the COVID-19 outbreak: A spatially interrupted
time-series (SITS) analysis. Annals of the American Associ-
ation of Geographers, 113(5): 1112–1134.
Zhao, W.; Zhang, S.; Wang, B.; and Zhou, B. 2023. Spatio-
temporal causal graph attention network for traffic flow pre-
diction in intelligent transportation systems.
PeerJ Com-
puter Science, 9: e1484.

A
Proof of Theorem 1
This section provides the complete proof for the conver-
gence of a Temporal Hierarchical Causal Model (T-HCGM)
to its corresponding Dynamic Collapsed Model (DCM).
Proof. The proof proceeds by mathematical induction on
the time horizon T. Let Pcol,t and P marg
m,t
denote the joint
distributions of the macro-state history (S1, . . . , St).
Base Case :
For T
=
1, we need to show that
limm→∞KL(Pcol,1 || P marg
m,1 ) = 0. The macro-state at
t = 1 is S1 = (XU
1 , Q1). Using the chain rule for KL-
divergence (Cover and Thomas 1991), we have:
KL(Pcol,1 || P marg
m,1 ) = KL(Pcol(Q1) || P marg
m
(Q1))
+EPcol(Q1)[KL(Pcol(XU
1 |Q1) || P marg
m
(XU
1 |Q1))] (6)
The first term, KL(Pcol(Q1) || P marg
m
(Q1)), is identi-
cally zero. This is because the generation of Q1 is, by defi-
nition, a unit-level process that does not depend on any sub-
unit realizations, and the DCM is constructed to preserve
this mechanism exactly. Thus, Pcol(Q1) = P marg
m
(Q1).
For the second term, we consider the inner KL-
divergence,
KL(Pcol(XU
1 |Q1)
||
P marg
m
(XU
1 |Q1)).
The distribution Pcol(XU
1 |Q1) is determined by the
true (but empty) subunit history measure, P<1, while
P marg
m
(XU
1 |Q1) is determined by the empirical measure
from m subunits, ˆPm,<1. By Assumption 1 (applied to an
empty history), this KL-divergence converges to zero as
m →∞. Since the integrand converges to zero for every
Q1 and is non-negative, the expectation also converges to
zero by the Dominated Convergence Theorem. Thus, the
base case holds.
Inductive Step: Inductive Hypothesis: Assume that for a
time horizon t −1, the theorem holds:
lim
m→∞KL(Pcol,t−1 || P marg
m,t−1) = 0
(7)
We must prove that the theorem also holds for the time
horizon t. We apply the chain rule for KL-divergence to the
joint distribution up to time t:
KL(Pcol,t || P marg
m,t
) = KL(Pcol,t−1 || P marg
m,t−1)
(8)
+EPcol,t−1 [KL (Pcol(St|S<t) || P marg
m
(St|S<t))]
(9)
By the Inductive Hypothesis, Term (8) converges to zero
as m →∞. The proof thus reduces to showing that Term
(9), the expected KL-divergence of the one-step transition
kernels, also converges to zero. We will establish this by
showing that the integrand converges to zero pointwise for
any given macro-history S<t.
Let us analyze the inner KL-divergence by decomposing
it for the components of St = (XU
t , Qt):
KL (Pcol(St|S<t) || P marg
m
(St|S<t))
= KL(Pcol(Qt|S<t) || P marg
m
(Qt|S<t))
+EPcol(Qt|S<t)[KL(Pcol(XU
t |Qt, S<t)
|| P marg
m
(XU
t |Qt, S<t))]
= Part A + Part B
(10)
Part A is identically zero because the generating mecha-
nism for the Q-variables, p(qt|Ui, Si,<t), is a unit-level pro-
cess preserved exactly in the DCM, making the two condi-
tional distributions identical.
For Part B, we focus on the inner KL-divergence term in-
side the expectation. The two conditional distributions for
XU
t
differ only in their dependence on the measure over
the subunit history space: Pcol(XU
t |Qt, S<t) depends on the
true measure P<t, while P marg
m
(XU
t |Qt, S<t) depends on
the empirical measure ˆPm,<t. The convergence of this KL
term to zero follows from a continuous mapping argument.
By Assumption A2, the class of subunit histories is a
Glivenko-Cantelli class. This guarantees the uniform con-
vergence of the empirical measure to the true measure (a re-
sult from empirical process theory, see, e.g., (Dudley 1999)),
i.e., ˆPm,<t →P<t almost surely in a suitable metric as
m →∞. By Assumption A1, the mapping from this mea-
sure to the output distribution of XU
t
is continuous in the
sense of KL-divergence. The Continuous Mapping Theorem
(Billingsley 1995) states that a continuous function of a con-
vergent sequence of random variables converges to the func-
tion of the limit. Applying this here, since the input measures
converge and the mapping is continuous, the output distri-
butions must also converge. The mode of convergence guar-
anteed by Assumption A1 is precisely what we need: the
KL-divergence between the output distributions converges
to zero. Since the integrand in Part B converges to zero for
every Qt, and is non-negative and appropriately bounded,
the entire expectation in Part B converges to zero by the
Dominated Convergence Theorem (Folland 2013).
Since both Part A and Part B are zero in the limit, the
KL-divergence of the one-step transition kernel converges to
zero. Consequently, Term (9) converges to zero. This com-
pletes the inductive step.
By the principle of mathematical induction, the theorem
holds for any finite time horizon T.
B
Proof of Theorem 2
This section provides the proof for the convergence of a
Spatio-Temporal Hierarchical Causal Model (ST-HCGM)
to its corresponding Spatio-Temporal Dynamic Collapsed
Model (ST-DCM).
Proof. The core of the proof is to construct a “Super-Unit”
model, Msuper, that is mathematically equivalent to the ST-
HCGM but formally satisfies the definition of a T-HCGM.
We will then show that the convergence of Msuper guaran-
teed by Theorem 1 implies the convergence stated in Theo-
rem 2.
Step 1: Construction of the Super-Unit Model
We define a single Super-Unit by aggregating all N spa-
tial units. The state variables and mechanisms of this Super-
Unit are defined as concatenations of the corresponding ele-
ments from the individual spatial units.
• Super-Unit State Variables:
– Static Exogenous Variable:
Usuper := (U1, U2, . . . , UN).

– Unit-Level Variables at time t:
XU
super,t := (XU
1,t, XU
2,t, . . . , XU
N,t).
– Q-Variables at time t:
Qsuper,t := (Q1,t, Q2,t, . . . , QN,t).
– Macro-State at time t:
Ssuper,t := (XU
super,t, Qsuper,t).
• Super-Unit Subunits: The set of subunits for the Super-
Unit is the union of all subunits from all spatial units,
totaling N × m. The mechanism for each unit-level vari-
able Xw
i,t within the Super-Unit’s state depends on the
empirical measure constructed from this entire collection
of subunits.
• Super-Unit Mechanism: The mechanism fsuper for the
Super-Unit is a vector-valued function where the i-th
component is the mechanism fi from the original ST-
HCGM. The evolution of the Super-Unit’s state is thus
described by:
Ssuper,t = fsuper(Ssuper,<t, Usuper,
Noisesuper,t, {Subunit Info}super)
(11)
Step 2: Verify Msuper is a Valid T-HCGM
We must verify that Msuper adheres to the definition of
a T-HCGM. The most critical requirement is that its un-
derlying causal graph, when unrolled over time, must be a
Directed Acyclic Graph (DAG). The structure of Msuper
is inherently acyclic across time steps, as any state at time
t can only depend on states at times t′ ≤t. The crucial
step is to establish acyclicity within a single time step t.
The dependencies among the components of the state vector
Ssuper,t = (S1,t, . . . , SN,t) are governed by the spatial in-
teractions of the original ST-HCGM. Assumption 4 (Spatial
Causal Ordering) imposes a strict, global ordering on these
contemporaneous interactions. Specifically, any component
Si,t can be influenced by another component Sj,t only if
j < i. This enforces a directed, acyclic structure on the
dependencies within any given time slice. Since the graph
is acyclic both across and within time steps, the unrolled
graph for Msuper is a DAG. The other definitional aspects
of a T-HCGM, such as the presence of a static confounder
and time-varying noise, are satisfied by construction. Thus,
Msuper is a valid T-HCGM.
Step 3: Verify Msuper Satisfies Premises of Theorem 1
We now verify that Msuper satisfies the assumptions re-
quired by the temporal collapsing theorem (Theorem 1). The
state space of the Super-Unit is a finite Cartesian product of
Polish spaces, which is itself a Polish space (Kechris 2012),
satisfying the regularity condition. The mechanism conver-
gence assumption for Msuper is also met, as it is a direct
consequence of the corresponding assumption on the origi-
nal ST-HCGM, combined with the uniform convergence of
the aggregated empirical measure over all subunits, which is
guaranteed by the Glivenko-Cantelli class assumption.
Step 4: Invoking Theorem 1 Since Msuper is a valid
T-HCGM that satisfies all the necessary premises, we can
directly invoke Theorem 1. This theorem guarantees that the
marginalized distribution of the Super-Unit model converges
to its collapsed distribution in KL-divergence:
lim
m→∞KL(Psuper,col,T || P marg
super,m,T ) = 0
where Psuper,col,T is the distribution of the collapsed Super-
Unit model and P marg
super,m,T is its marginalized distribution.
The final step is to establish the equivalence between
the distributions of the Super-Unit model and the original
ST-HCGM. By construction, the macro-state space of the
ST-HCGM is identical to the state space of the Super-Unit
model. Consequently, the marginalized distribution P marg
m,T,N
of the ST-HCGM is the same as P marg
super,m,T . Similarly, the
Spatio-Temporal Dynamic Collapsed Model (ST-DCM) de-
scribes the exact same limiting process as the collapsed
model of the Super-Unit, meaning Pcol,T,N = Psuper,col,T .
Given these equivalences, the convergence result for the
Super-Unit model directly implies the convergence for the
Spatio-Temporal model.
C
Proofs for Identifiability
This section provides proofs for the identifiability theorems
for Temporal Hierarchical Causal Models (T-HCMs) and
Spatio-Temporal Hierarchical Causal Models (ST-HCMs).
C.1
Proof of Proposition 1
We first restate the propositions concerning identifiability in
the purely temporal setting. The proofs operate on the Dy-
namic Collapsed Model (DCM), whose existence and con-
vergence properties are guaranteed by the temporal collaps-
ing theorem.
Proof. The problem of identifying the causal effect is
equivalent to identifying the post-intervention distribution
P(QY
i,t| do(QA
i,t′ = δa∗)) in the DCM. The primary obsta-
cles are the backdoor paths connecting QA
i,t′ and QY
i,t. These
paths arise from two sources: (1) dynamic confounding from
the system’s history, and (2) static confounding from the
time-invariant latent variable Ui.
By the premise of the proposition, all dynamic back-
door paths are intercepted by the observable macro-history
Si,<t′. We can therefore apply the backdoor adjustment for-
mula (Pearl 2009), integrating over the distribution of this
history to block these paths:
P(QY
i,t| do(QA
i,t′)) =
Z
P(QY
i,t| do(QA
i,t′), s<t′)P(s<t′)ds<t′
After conditioning on a specific history realization s<t′, the
only remaining unblocked backdoor path is the one medi-
ated by the static confounder, QA
i,t′ ←Ui →QY
i,t. At this
stage, we leverage the hierarchical structure. The law of to-
tal probability allows us to express the conditional interven-
tional distribution as an expectation over Ui:
P(QY
i,t| do(QA
i,t′), s<t′)
= EUi|s<t′

P(QY
i,t| do(QA
i,t′), s<t′, Ui)

(12)

Crucially, once we condition on Ui, all backdoor paths
are blocked. Thus, the do operator can be removed, and the
inner term becomes an estimable quantity from the obser-
vational distribution of a specific unit i (for which Ui is
fixed). While Ui is unobserved, we can estimate this ex-
pectation by first estimating the unit-specific effect from its
subunit-level panel data, and then averaging these estimates
across all units. Since all components of the final expression
are computable from observational data, the causal effect is
identifiable.
C.2
Proof of Proposition 2
Proof. A valid instrumental variable Zij,t′, represented by
the node QZ
i,t′ in the DCM, is by definition d-separated from
all confounding sources, including the static Ui and any un-
observed history. This exogeneity allows us to relate the
desired causal effect to the observational distribution. Let
g(a) := P(Yt| do(At′ = a)) be the target causal effect dis-
tribution. The exclusion restriction of the instrument implies
that the observed association between the instrument Zt′ and
the outcome Yt is mediated entirely through the treatment
At′. This relationship can be formalized by the following
integral equation:
P(Yt|Zt′ = z) =
Z
g(a) · P(At′ = a|Zt′ = z)da
(13)
This is a Fredholm integral equation of the first kind. The
left-hand side, P(Yt|Zt′ = z), and the kernel of the integral,
P(At′ = a|Zt′ = z), are both identifiable from the obser-
vational joint distribution of variables in the DCM. Under
standard regularity conditions that ensure the invertibility of
the integral operator defined by the kernel (a completeness
condition, see (Newey and Powell 2003)), this equation can
be solved for the unknown function g(a). Since g(a) can
be uniquely determined from observational quantities, the
causal effect is identifiable.
C.3
Proof of Theorem 3
Proof. The proof directly generalizes that of Proposition
1. The problem is first translated to the ST-DCM via the
spatio-temporal collapsing theorem. The set of confounding
backdoor paths now includes those that traverse through the
histories of spatial neighbors. By the premise of the theo-
rem, this entire set of dynamic and spatial backdoor paths is
blocked by conditioning on the observable spatio-temporal
history, Histobs
ST,<t′. Applying the backdoor adjustment for-
mula yields:
P(QY
k,t| do(QA
i,t′)) =
Z
P(QY
k,t| do(QA
i,t′), hst)P(hst)dhst
(14)
After this adjustment, the only remaining backdoor paths are
those mediated by the set of all static confounders {Uj}N
j=1.
As in the temporal case, the hierarchical structure allows us
to overcome this. By conditioning on the full set of static
confounders Uall = (U1, . . . , UN), all backdoor paths be-
come blocked. The resulting conditional interventional dis-
tribution can be estimated from the observational data within
unit-groups that share the same (unobserved) values of Uall.
The final estimand is obtained by averaging over the popula-
tion of units. Therefore, the causal effect is identifiable.
C.4
Proof of Theorem 4
Proof. The proof structure is identical to that of Proposition
2. A valid spatio-temporal instrument Zij,t′, represented by
QZ
i,t′ in the ST-DCM, must be exogenous with respect to
the entire confounding system. This means it must be d-
separated from the set of all static confounders {Uk} and the
complete unobserved history of the entire spatio-temporal
system.
Given such an instrument, we can again formulate the
Fredholm integral equation relating the causal effect distri-
bution gk(a) := P(Yk,t| do(Ai,t′ = a)) to observational
quantities:
P(Yk,t|Zi,t′ = z) =
Z
gk(a) · P(Ai,t′ = a|Zi,t′ = z)da
(15)
The terms on the left and the kernel of the integral are iden-
tifiable from the observational distribution of the ST-DCM.
Provided the completeness condition holds for the instru-
ment, this equation has a unique solution for gk(a). Thus,
the full causal effect distribution is identifiable.
D
Details for ATE Estimation
D.1
Linear Mixed-Effects Model Specification
This section details the implementation of our two-stage
estimation algorithm when using a semi-parametric Lin-
ear Mixed-Effects Model (LMM) as the unit-specific con-
ditional mechanism, Mi. LMMs, also known as panel data
models with fixed effects in econometrics, are a natural
choice for this problem as they are explicitly designed to
handle unobserved time-invariant heterogeneity.
Stage 1: Learning Conditional Dynamics with LMMs
The first stage aims to estimate the conditional expectation
of the outcome, E[Yij,t|Historyi,<t, Ui], under the assump-
tion of linear relationships. Unlike the non-parametric ap-
proach where an independent model is trained for each unit,
the LMM leverages a more statistically efficient pooled re-
gression across all units and subunits.
The core idea is to model the static, unobserved con-
founder Ui as a unit-specific fixed effect. This is achieved
by including a dummy variable for each unit in the re-
gression model. This approach effectively absorbs all time-
invariant differences between units, including the effect of
Ui, into these unit-specific intercepts.
We fit a single, global LMM to the entire subunit-level
dataset. The model is specified by the following linear for-
mula:
Yij,t = αi + βAAij,t + βtemp ¯Yi,t−1
+ ρ ¯YN (i),t−1 + ϵij,t
(16)
where αi represents the fixed effect for unit i, and the co-
efficients βA, βtemp, and ρ are shared across all units. The
treatment effect, βA, is the primary parameter of interest es-
timated in this stage.

Stage 2: Conditional G-Computation via Simulation
With the fitted LMM, we perform a conditional G-
computation procedure as in Algorithm 1 to estimate the
average treatment effect. This stage remains conceptually
identical to the non-parametric case, but the prediction at
each step uses the fitted linear model instead of a GBM.
The simulation for each unit i under a fixed policy a∗pro-
ceeds recursively. At each time step t, we predict the poten-
tial outcome ˆyi,t(a∗) using the fitted coefficients from Equa-
tion 16:
• The fixed treatment assignment, a∗, is used for the term
βAa∗.
• The unit-specific intercept, ˆαi, learned during Stage 1, is
used. This is the crucial step that conditions the predic-
tion on the unit’s unique characteristics (i.e., on Ui).
• The temporal lag is taken from the simulated history of
unit i.
• The spatial lag is taken from the observed history of unit
i’s neighbors.
This process is repeated until we obtain the final poten-
tial outcome ˆyi,T (a∗), which represents the estimate of
EG-Comp[YT |do(At = a∗), U = ui].
Final ATE Calculation
The final ATE is computed by av-
eraging the simulated potential outcomes across all units, ex-
actly as in the GBM case:
d
ATET = 1
N
N
X
i=1
ˆyi,T (1) −1
N
N
X
i=1
ˆyi,T (0).
(17)
D.2
Gradient Boosting Machines Specification
This section provides a description of the two-stage estima-
tion algorithm presented in the main text, specifically for the
non-parametric Gradient Boosting Machine (GBM) imple-
mentation of the unit-specific conditional mechanism, Mi.
Stage 1: Learning Conditional Dynamics with GBMs
The first stage involves learning the conditional dynamics
for each unit. The goal is to estimate the conditional ex-
pectation of the outcome, E[Yi,t|Historyi,<t, Ui], where the
conditioning on the unobserved, time-invariant confounder
Ui is crucial.
To achieve this, we train an independent GBM for each
unit i, which we denote as Mi. Training a separate model
for each unit is a standard strategy to implicitly condition
on unit-specific fixed effects. In this way, each model Mi
learns the unique dynamic patterns of its corresponding re-
gion, effectively accounting for the influence of that region’s
unique time-invariant characteristics, Ui.
The target variable for each model Mi is the subunit-level
speed, Yij,t. The feature set consists of the relevant tempo-
ral and spatial history, including lagged speeds, lagged treat-
ments, and the historical states of neighboring units, as spec-
ified in our experimental setup.
Stage 2: Conditional G-Computation via Simulation
With the set of trained models {Mi}N
i=1, we perform a con-
ditional G-computation procedure as outlined in Algorithm
1 to estimate the potential outcomes under different global
treatment policies. This stage involves two parallel simula-
tions for each unit i, one for the policy do(At = 0) and
another for do(At = 1).
The simulation for a single unit i under a fixed policy a∗
proceeds recursively from t = 1 to T. At each time step t,
we predict the potential outcome ˆyi,t(a∗) using the trained
model Mi. The input features for this prediction are con-
structed from:
• The fixed treatment assignment, a∗.
• The simulated history of unit i up to time t −1, which
is built using the outcomes predicted in previous steps of
the simulation.
• The
observed
history
of
unit
i’s
neighbors,
{Sk,<t}k∈N (i).
This recursive process is repeated until we obtain the final
potential outcome for unit i at the time horizon T, denoted
ˆyi,T (a∗). This value serves as an estimate of the inner expec-
tation in our identification formula, EG-Comp[YT |do(At =
a∗), U = ui].
Final ATE Calculation
After completing the simulations
for all N units under both treatment policies (a∗= 0
and a∗= 1), we obtain two sets of potential outcomes:
{ˆyi,T (0)}N
i=1 and {ˆyi,T (1)}N
i=1. The final ATE is computed
by averaging across these unit-specific estimates, which cor-
responds to the outer expectation over the distribution of U:
d
ATET = 1
N
N
X
i=1
ˆyi,T (1) −1
N
N
X
i=1
ˆyi,T (0).
(18)
This non-parametric, simulation-based approach allows us
to estimate the causal effect while accommodating the com-
plex, non-linear dynamics learned by the GBMs.
D.3
Gaussian Process Model Specification
In our case study, we can also employ a unit-specific Gaus-
sian Process (GP) model(Rasmussen and Williams 2006),
denoted as Mi, to estimate the conditional dynamics for
each unit i. This appendix provides the detailed specifica-
tion of this GP model.
The GP framework offers a principled, non-parametric
approach to learn the complex, non-linear function govern-
ing the spatio-temporal dynamics, conditional on the unit’s
latent static properties Ui. For each unit i, we model the
subunit-level outcome Yij,t as being generated by a latent
function gi(·) corrupted by i.i.d. Gaussian noise:
Yij,t = gi(xij,t) + ηij,t,
ηij,t ∼N(0, σ2
n)
(19)
where xij,t is the input feature vector for subunit j in unit i
at time t, and σ2
n is the noise variance. We place a GP prior
on the latent function gi:
gi(·) ∼GP(mi(·), ki(·, ·′))
(20)
where mi(·) is the mean function and ki(·, ·′) is the covari-
ance (kernel) function. The use of GPs for spatio-temporal
modeling is a well-established practice in (Gelfand et al.
2010; Cressie and Wikle 2011)

Input Feature Vector
The input feature vector xij,t is de-
signed to encode all relevant information for predicting the
outcome. For our specific problem, it comprises:
• Treatment: The current treatment assignment Aij,t.
• Time Stamp: The current time index t.
• Lagged Outcome: The subunit’s own outcome from the
previous time step, Yij,t−1.
• Spatial Lag: A summary of neighbors’ outcomes from
the previous time step, defined as the average outcome in
the neighborhood N(i):
¯YN(i),t−1 =
1
|N(i)|
X
k∈N (i)
¯Yk,t−1
(21)
where ¯Yk,t−1 is the average subunit outcome in unit k at
time t −1.
The full input vector is thus:
xij,t = [Aij,t, t, Yij,t−1, ¯YN(i),t−1]T .
(22)
Mean and Covariance Functions
For simplicity and flex-
ibility, we set the prior mean function to zero, mi(x) = 0,
allowing the kernel to capture the full complexity of the dy-
namics.
The soul of our GP model is the composite kernel func-
tion ki(x, x′), which we construct as a sum of kernels to
model different sources of variation(Duvenaud 2014). For
two input vectors x and x′, the kernel is:
ki(x, x′) = ktime(t, t′) × kcov(z, z′)
(23)
where z = [A, Ylag, ¯Yspatial lag] represents the non-temporal
features. This product structure allows for a non-stationary
model where the covariance structure of the covariates can
evolve over time.
Temporal Kernel:
We use the Mat´ern 5/2 kernel to model
temporal dependencies, which is a common choice for phys-
ical processes as it assumes the underlying function is twice-
differentiable.
kMatern52(t, t′) = σ2
t
 
1 +
√
5d
lt
+ 5d2
3l2
t
!
exp
 
−
√
5d
lt
!
(24)
where d = |t−t′|, and σ2
t and lt are the variance and length-
scale hyperparameters, respectively.
Covariate Kernel:
We use the standard Radial Basis
Function (RBF) kernel, also known as the squared expo-
nential kernel, for the remaining covariates. We employ Au-
tomatic Relevance Determination (ARD), which assigns a
separate lengthscale parameter ld to each dimension d of the
input z.
kRBF-ARD(z, z′) = σ2
z exp
 
−1
2
D
X
d=1
(zd −z′
d)2
l2
d
!
(25)
The ARD mechanism allows the model to learn the relative
importance of each feature.
Model Fitting
For each unit i, the hyperparameters θi =
{σ2
n, σ2
t , lt, σ2
z, {ld}} of the model Mi are learned by maxi-
mizing the log marginal likelihood of the observed data Di.
This is typically done using gradient-based optimizers. The
resulting trained models {Mi}N
i=1 are then used in Stage 2
of our estimation algorithm (Algorithm 1) to perform coun-
terfactual simulations.
Crucially, while Mi is trained as a predictive model, its
role in our framework is to serve as a non-parametric estima-
tor for the unit-specific conditional dynamics. Because Mi
is trained on data centered at unit i, it implicitly conditions
on the latent static properties Ui. Therefore, under the iden-
tification guarantees of Theorem 3, using this trained model
Mi to simulate outcomes under a do-intervention (as per-
formed in Stage 2 of Algorithm 1) yields a valid estimate of
the conditional causal effect E[·|do(·), Ui].
E
Experiment Details
This section provides supplementary details for the experi-
ments presented in the main paper. We elaborate on the syn-
thetic data generation process, model implementations, and
provide a description of the real-world dataset.
E.1
Details of the simulation experiment
Data Generation Process
We generate synthetic data
from a Spatio-Temporal Hierarchical Causal Model (ST-
HCM) designed to test the core challenges of unobserved
confounding and spatial spillover. The process involves N
units, each with m subunits, observed over T time steps.
A time-invariant, unobserved confounder Ui is drawn
for each unit i from a standard normal distribution, Ui ∼
N(0, 1). This confounder influences both treatment assign-
ment and outcomes throughout the simulation.
The results presented in the main paper’s Table 1 are
based on a data generating process with linear relationships,
providing a clear testbed for the causal identification capa-
bilities of different model structures. The generation process
for each subunit (i, j) at time t is as follows:
1. Treatment Assignment:
The treatment Aij,t ∈{0, 1}
is a binary variable drawn from a Bernoulli distribution
whose probability is a non-linear function of the confounder
Ui:
Aij,t ∼Bernoulli(σ(γ · Ui −0.5))
(26)
where σ(·) is the sigmoid function and γ is the confounding
strength. This ensures that treatment assignment is endoge-
nously determined by the unobserved confounder.
2. Outcome Generation:
The outcome Yij,t is generated
as a linear combination of the confounder’s main effect, the
treatment effect, temporal and spatial lags, and i.i.d. noise:
Yij,t = γ · Ui + βA · Aij,t + βtemp · ¯Yi,t−1
+ ρ · ¯YN (i),t−1 + ϵij,t
(27)
where:
• βA is the true Average Treatment Effect (ATE).
• ¯Yi,t−1 is the average outcome of unit i at time t −1.

• ¯YN(i),t−1 is the average outcome of unit i’s neighbors
N(i) at time t −1.
• ρ is the spatial spillover strength.
• ϵij,t ∼N(0, σ2
ϵ ) is the subunit-level noise.
Simulation Parameters:
For the experiments in Table 1,
we used the following parameters: N = 16, m = 50, T = 8,
βA = 5.0, βtemp = 0.5, σ2
ϵ = 4. The values for γ and ρ are
varied as indicated in the table.
E.2
Robustness Analysis Data Generation
This section details the data generation processes used for
the robustness analysis. Our aim is to systematically intro-
duce controlled violations of key assumptions underlying
hierarchical linear models (LMMs), particularly the time-
invariance of the unobserved confounder and the acyclic na-
ture of contemporaneous spatial effects. All experiments are
conducted with N = 16 units, m = 50 subunits, and T = 8
time steps. The base confounding strength is γ = 2.0 and
spatial spillover strength is ρ = 1.5.
Violating Time-Invariance of the Confounder
The stan-
dard ST-HCM (LMM) with fixed effects assumes that the
unobserved unit-level confounder Ui is time-invariant. To
violate this assumption, we allow Ui to evolve over time,
transforming it into a time-varying confounder Uit. Specifi-
cally, Uit follows a simple random walk:
Uit = Ui,t−1 + δ · ϵU
it
where Ui,0 is drawn from a standard normal distribution, ϵU
it
is i.i.d. standard normal noise, and δ is the confounder drift
strength parameter. A higher δ implies a more rapidly chang-
ing confounder, making it harder for fixed effects to control.
The treatment assignment and outcome generation mecha-
nisms then depend on this time-varying Uit instead of Ui.
When δ = 0, the confounder is static, corresponding to the
assumption holding.
Violating Spatial Ordering
Our framework assumes a
causal ordering among units at each time step, implying that
contemporaneous spatial influences are unidirectional (e.g.,
from unit j to unit i only if j < i). To violate this strict
ordering and introduce simultaneous, bi-directional spatial
effects, we modify the noise term of the outcome genera-
tion. Instead of being independent, the subunit-level noise
ϵijt is influenced by the average noise of its neighbors at the
same time step. Specifically, the observed noise for subunit
j in unit i at time t becomes:
˜ϵijt = ϵijt + κ ·


1
|N(i)|
X
k∈N (i)
ϵkjt


where ϵijt are i.i.d. standard normal noise, N(i) denotes the
set of all spatial neighbors of unit i, and κ is the cyclicity
strength parameter. A non-zero κ introduces contemporane-
ous spatial correlation in the unobserved error terms. This
violation cannot be fully controlled by standard linear mod-
els, as it introduces endogenous error terms that are corre-
lated across space within the same time step. When κ = 0,
the spatial ordering assumption holds, and the noise is inde-
pendent across units.
E.3
Chicago Traffic Dataset
Our real-world analysis uses three publicly available
datasets from the City of Chicago data portal1. We focus
on a one-week period in January 2025 (from January 5th to
January 11, 2025) for our case study.
Data Sources
The core components of our dataset are:
• Regions: The 29 official traffic regions (our units) pro-
vide the spatial partitioning of the city. Each region is
composed of two to three community areas with compa-
rable traffic patterns.
• Segments: Arterial traffic segments (our subunits) pro-
vide real-time speed estimates every 10 minutes. These
estimates are derived from the GPS traces of Chicago
Transit Authority (CTA) buses. As noted by the data
provider, individual segment speeds can be highly
volatile due to factors like traffic signals and intersec-
tions.
• Crashes: Records of traffic accidents provide the precise
time and location of crash events, which form the basis
of our treatment variable.
Preprocessing and Feature Engineering
We first per-
formed a spatial join to assign each of the 1,025 unique road
segments to its corresponding traffic region(s). The crash
events were then assigned to a region and subsequently as-
signed to the nearest road segment within the boundaries of
that region.
The key step in our analysis was defining the treatment
variable at the unit level. A region was considered treated at
a given 10-minute time step if one or more crashes occurred
within it. This unit-level treatment allows its effect to be es-
timated across all subunits in the region. The final feature set
for our full ST-HCM model included:
• Temporal lags: The subunit’s own speed at t −1
(speed lag1) and the unit’s treatment status at t −1
(unit treatment lag1).
• Spatial lags: The average speed and treatment status of
neighboring regions at t −1.
• Time features: The hour of the day and the day of the
week, treated as categorical variables.
1https://data.cityofchicago.org/
