Inferring the Impacts of Baryonic Feedback from Kinetic Sunyaev-Zeldovich Cross-Correlations
Alex Lagu¨e,1 Mathew S. Madhavacheril,1 Josh Borrow,1
Kendrick M. Smith,2 Xinyi Chen,3 Matthieu Schaller,4, 5 and Joop Schaye5
1Department of Physics and Astronomy, University of Pennsylvania, Philadelphia, PA 19104, USA
2Perimeter Institute for Theoretical Physics, 31 Caroline St North, Waterloo, ON N2L 2Y5, Canada
3Center for Cosmology and AstroParticle Physics (CCAPP),
The Ohio State University, Columbus, OH 43210, USA
4Lorentz Institute for Theoretical Physics, Leiden University, PO box 9506, 2300 RA Leiden, the Netherlands
5Leiden Observatory, Leiden University, PO Box 9513, 2300 RA Leiden, the Netherlands
The complex processes of baryonic feedback associated with galaxy evolution are still poorly understood, and
their impact on the clustering of matter on small scales remains difficult to quantify. While many fitting functions
and emulators exist to model the matter power spectrum, their input parameters are not directly observable.
However, recent studies using hydrodynamical simulations have identified a promising correlation between the
gas content of halos and changes to the matter power spectrum from feedback. Building on these findings, we
create the first fully data-driven power spectrum emulator. We utilize the kinematic Sunyaev-Zeldovich (kSZ)
effect, a secondary anisotropy in the cosmic microwave background, as a tracer of free electrons in and around
halos. We train a neural network to learn the mapping between the suppression of the matter power spectrum
and the shape of the kSZ power spectrum extracted with a radial velocity template. We train and validate our
algorithm using the FLAMINGO suite of hydrodynamical simulations, which encompasses a wide range of
feedback models. Our emulator can reconstruct the matter power spectrum at the sub-percent level for scales
k ≤5 h/Mpc and 0.2 ≤z ≤1.25 directly from the data. Our model is robust and retains percent-level accuracy
even for feedback models and cosmological parameter values not seen during training (except in a few extreme
cases drastically different from the fiducial model). Due to its robustness, our algorithm offers a new way to
identify the sources of suppression in the matter power spectrum, breaking the degeneracies between baryonic
feedback and new physics. Finally, we present a forecast for reconstruction of the matter power spectrum
combining maps of the microwave background anisotropies from a Simons Observatory-like experiment and
galaxy catalogs from the Dark Energy Spectroscopic Instrument.
I.
INTRODUCTION
The standard model of cosmology agrees remarkably well
with observations of the early universe, despite necessitat-
ing only around six parameters. Measurements of the pri-
mary anisotropies [1–4] and gravitational lensing of the cos-
mic microwave background (CMB) [5–11] give a consistent
picture of the growth of structure over billions of years (see
[12] for a recent review). However, some observations of the
late universe paint a different picture. Apart from tensions
and disagreements associated with expansion measurements
(e.g. [13, 14]), many measurements of cosmic shear such
as those from the Dark Energy Survey [15] and the Hyper-
Suprime Cam (HSC) [16, 17] surveys show a preference for a
lower level of clustering than the CMB best-fit model (though
KiDS cosmic shear now agrees better with the CMB predic-
tion [18]). The level of matter clustering is often parame-
terized by the root-mean-squared amplitude of fluctuations
smoothed on scales of 8 Mpc/h, denoted σ8, or by its value
rescaled by the matter density S 8 = σ8(Ωm/0.3)0.5. This dis-
crepancy has been coined the “S 8-tension”, and multiple so-
lutions have been suggested to reconcile the conflicting mea-
surements.
Baryonic processes such as AGN feedback, supernova
feedback, and star formation are poorly understood. These
effects redistribute matter on small scales and induce system-
atic errors when inferring S 8 from weak lensing data. It has
been argued that models with a higher level of baryonic feed-
back can reconcile conflicting measurements of S 8 by low-
ering the amplitude of the matter power spectrum on small
scales and at late times (see e.g. [17, 19–23]).
The kinetic Sunyaev-Zeldovich (kSZ) effect is a secondary
CMB anisotropy resulting from the Doppler shift of CMB
photons due to Thomson scattering off free electrons moving
along the line of sight. We define the electron radial momen-
tum as
qr(x) ≡[1 + δe(x)] vr(x),
(1)
where δe and vr denote the electron density contrast and radial
peculiar velocity. The electron velocity is dominated by the
large-scale linear velocity that relates to the matter density
contrast (δm) by inverting the Laplacian in Poisson’s equation,
giving
vr(k) = iµ faH
k
δm(k),
(2)
where k is the comoving wavenumber, µ is the cosine of the
angle between the wavenumber and the line-of-sight vector,
f is the logarithmic linear growth rate, a is the cosmological
scale factor, and H is the Hubble expansion rate. The tem-
perature fluctuations induced by non-zero qr in the direction
ˆn follow
∆TkSZ(ˆn) =
Z z∗
0
dz dχ
dz K(z)qr(ˆn, z),
(3)
where χ is the comoving distance to the observer and
K(z) = −TCMB¯ne,0σT(1 + z)2e−τ(z),
(4)
where TCMB is the background (average) CMB temperature,
¯ne,0 is the comoving mean free electron number density at the
arXiv:2511.20595v1  [astro-ph.CO]  25 Nov 2025

2
present day, σT is the Thomson cross-section, and τ is the
mean optical depth for electron scattering.
The kSZ effect can be used as a probe of baryonic feed-
back; extracted through velocity-weighted stacking of the
CMB map at the location of galaxies [24–29], it has been suc-
cessfully used in combination with weak gravitational lens-
ing [30].
Recent studies involving multiple probes show
a preference for stronger feedback models in simulation
suites (e.g. [31–37]). When using the kSZ as a probe of feed-
back, the stacked electron profile is compared to the output of
a diverse set of simulations. It is worth noting that the simu-
lations used as a means for comparison are often calibrated to
match the gas fraction observed in X-ray measurements [38–
43]. Recent works such as [44] suggest that the X-ray gas
fraction may need to be revised to account for new mea-
surements from the eROSITA mission [45]. Multiple studies
report lower gas fractions in X-ray clusters than previously
measured, potentially due to selection effects. Ref. [46] cau-
tions, however, that current simulations with enhanced feed-
back models also predict excessive levels of quenching for
galaxies in high-mass halos.
When using the kSZ as a probe of feedback, the selection
of galaxies must match the properties of the survey to en-
sure a fair comparison. Thus, matching hydrodynamical sim-
ulations to kSZ stacking observations can be a challenging
task. The comparison to simulations is also generally done
individually for each feedback model. An exception to this,
presented in [36], leverages the 400 realizations in the AN-
TILLES simulation suite (see [42]). One limitation of this
dataset is that, due to their small box size, the ANTILLES
simulations cannot capture variations in the cosmic velocity
field. This is because the velocities have a correlation length
comparable to the simulation box size of 100 Mpc/h. In
this study, we present an alternative approach allowing for
the inference of the matter power spectrum shape while inter-
polating between a limited number of hydrodynamical sim-
ulations with very large box sizes. Our method enables us
to marginalize over the galaxy selection effect and jointly fit
for the galaxy angular power spectrum with the kSZ signal
(which we measure in spherical harmonics space from a tem-
plate, rather than using aperture photometry).
The kSZ effect has increasingly been used as an alternate
probe of feedback. The precision of kSZ measurements is set
to improve significantly in the near future, with a current de-
tection significance of ∼10σ forecasted to reach ∼100σ with
Stage-IV galaxy surveys [47]. While a direct comparison of
electron profiles in halos from individual simulations allows
for a qualitative assessment, a model that enables more di-
rect sampling of the shape of the power spectrum is a natural
next step. Following this line of thought, our emulator frame-
work proves it is possible to infer the shape of the matter
power spectrum while accurately and continuously interpo-
lating between a limited set of hydrodynamical simulations.
This work is set to be the first of a series leading to the re-
lease of matter power spectrum shape constraints independent
of gravitational lensing. Our approach will enable enhanced
constraints on new physics by breaking the degeneracy be-
tween baryonic feedback and other sources of structure sup-
pression.
A.
Template Approach for kSZ
The template method for extracting the kSZ signal consists
of creating a galaxy momentum map and cross-correlating it
with a map of the CMB [48, 49]. Since the primary CMB and
the instrument noise do not correlate with the galaxy line-of-
sight velocity field, the cross-correlation process extracts the
kSZ contribution from the map. Data analyses so far have
performed velocity-weighted stacking of CMB maps at the
location of galaxies. We demonstrate here on simulations the
harmonic-space equivalent of the traditional stacking analy-
sis. The cross-correlation bandpowers we construct Cℓare
significantly easier to work with since their covariance ma-
trix is nearly diagonal. (See for instance, Ref. [50] for more
details on the modeling of the Fourier-space approach.)
To build a template, we begin by computing the galaxy
density field on the sky, defined as
δg(ˆn) = ng(ˆn)
¯ng
−1,
(5)
where ˆn is the unit vector of an angle on the sky and ¯ng is the
mean number density of galaxies over the full sky. For the
velocity field, we average the radial velocities of the galax-
ies that fall within the same pixels. Once we have these two
maps, we generate the galaxy momentum template by multi-
plying them on a pixel-by-pixel basis such that
ˆb(ˆn) = δg(ˆn)vr(ˆn).
(6)
The Doppler b parameter captures the same information as
the kSZ, and the two can be related via
b ≡−∆TkSZ
TCMB
.
(7)
The kSZ effect induces a bispectrum between large-scale
structure and the CMB. As shown in [47], this bispectrum is
dominated by the squeezed limit, and we separate the signal
into two relevant scales: the small-scale electron density fluc-
tuations at kS ≳1 and the large-scale cosmic velocity field at
kL ≲0.1. The correlation between the template and the true
kSZ can be calculated from the true and estimated field power
spectra. Defining ˆqr(x) ≡δg(x)vr(x), and following [51], this
gives
Pˆqrqr(kS , z) ≈Pge(kS , z)
Z dkL
4π2
Z
dµL Pvrvr(kL, µL, z),
(8)
where µL is the cosine of the angle between the large-scale
mode and the line of sight. Here, we assume that the galaxy
radial velocities are known. In practice, they are estimated
through an initial density field reconstruction procedure. We
discuss the impact of imperfections in the reconstruction in
Appendix A. The linear radial velocity power spectrum is ob-
tained from the linear matter power spectrum (Pmm) through
Pvrvr(kL, µL, z) =
 
iµL
faH
kL
!2
Pmm(kL, z).
(9)

3
The small-scale galaxy-electron cross-spectrum can be com-
puted using a halo model approach, giving (on one-halo dom-
inated scales)
Pge(kS , z) =
Z
dMh n(Mh) Mh
¯ρm
ugas(kS , z; Mh)
× 1
¯ng
[⟨Ncen⟩(Mh) + ⟨Nsat⟩(Mh)usat(kS , z; Mh)] ,
(10)
where ⟨Ncen/sat⟩are the expected number of central and satel-
lite galaxies in halos of mass Mh, n is the comoving number
density of halos of a given mass, and ¯ρm is the mean comoving
matter density. Also, usat is the Fourier transform of the satel-
lite galaxies’ number density as a function of scale, and ugas
is the Fourier transform of the gas density profile measured
by the stacking approach to kSZ. The theoretical expectation
value of the measured cross-spectrum is given by
C
ˆbb
ℓ=
Z zmax
zmin
dz
χ2(z)
dχ
dz
K(z)
TCMB
Pˆqrqr
 ℓ+ 1/2
χ(z) , z
!
(11)
=
Z zmax
zmin
dz
χ2(z)
dχ
dz
σ2
vr(z)K(z)
TCMB
Pge
 ℓ+ 1/2
χ(z) , z
!
,
(12)
where we define the variance in the large-scale velocity fluc-
tuations 4π2σ2
vr ≡
R
dkLdµL Pvrvr. The kSZ spectrum also
holds information about the baryon fraction in halos through
the gas profile ugas. Measuring the kSZ cross-spectrum with
the template method thus provides a means to determine the
halo baryon fraction as a function of halo mass.
II.
METHODOLOGY
We develop a pipeline to parameterize and quantify the im-
pact of baryonic feedback on the shape of the matter power
spectrum as a function of the observed kSZ effect. An in-
creasing number of emulators and fitting functions for the
non-linear matter power spectrum, accounting for baryonic
effects, exist in the literature. These include Gaussian pro-
cesses [52–54], fitting functions [42], and neural networks
[55]. All the emulators in the literature take as input cosmo-
logical and surrogate baryonic feedback parameters (such as
the baryon fraction in halos). The baryonic feedback param-
eters are often defined as a function of the subgrid models
for the simulations on which the emulator was trained. While
helpful to marginalize over feedback parameters, these mod-
els take as input values that cannot be directly measured, such
as the AGN feedback gas heating or the halo baryon fraction.
On the other hand, our framework is the first to infer the im-
pact of baryonic feedback directly from cosmological obser-
vations.
A.
FLAMINGO Simulations
The Virgo Consortium’s FLAMINGO suite is a set of hy-
drodynamical simulations with large cosmological boxes and
relatively high resolution [43, 56]. The FLAMINGO suite en-
compasses a diverse range of baryonic feedback models. No-
tably, all the hydrodynamical simulations have dark matter-
only (DMO) counterparts. This allows for the computation of
the matter power spectrum suppression, which we define as
R(k) ≡
P(k)
PDMO(k),
(13)
where P and PDMO denote the total matter power spectra of
their respective simulations. The large dataset contains maps
of the kSZ effect and detailed halo catalogs with associated
galaxy properties. The kSZ effect is stored on the lightcone
with the Doppler b parameter
bsim =

nemgσT
Ω2
pixeld2
Aρ
vr,
(14)
where me is the electron mass, ne is the free electron number
density, mg is the gas particle mass, ρ is the gas density, Ωpixel
is the solid angle of a HEALPix pixel, and dA is the angular
diameter distance to the observer1.
To train our emulator,
we use the following sim-
ulations:
L1 m9,
fgas±2σ,
fgas−4σ,
fgas−8σ,
M*−σ,
M*−σ+fgas−4σ,
Jet,
Jet
fgas−4σ,
Planck,
PlanckNu0p24Fix, PlanckNu0p48Fix, LS8, LS8 fgas−8σ.
This allows us to explore a wide range of feedback mecha-
nisms, account for the impact of lowering the matter power
spectrum’s amplitude, and check our methods against varying
neutrino masses.
The ±Nσ notation refers to simulations
where the cluster gas fractions were shifted by N times the
error on X-ray and weak lensing data compiled by [56].
A scaling relation between the suppression of the matter
power spectrum and baryonic feedback was found in [41].
Building on the work of [57, 58], they showed that the baryon
fractions of halos of different masses (defined as the baryon
mass to total mass ratio, normalized to the cosmic mean of
Ωb/Ωm) are a direct probe of the baryonic suppression of the
power spectrum as a function of scale. This relationship was
shown to hold for a wide range of baryonic feedback models.
This information was used to devise a fitting function for the
power spectrum in [42]. In Fig. 2, we can see that a similar
correlation exists for the kSZ cross-spectrum. For the latter,
the relation is more complex as it depends on the properties
of the galaxy survey used to generate the template. It also de-
pends on the effects of feedback on galaxy formation and stel-
lar mass. This introduces scatter in the relationship between
the kSZ cross-spectrum at a given multipole and the shape
of the matter power spectrum. To extract information about
the power spectrum despite these sources of uncertainty, we
generate many galaxy catalogs for each feedback mechanism.
We then train a neural network to use the angular power spec-
trum of the galaxies (Cgg
ℓ) to remove degeneracies between
the template and the true electron distribution.
1 The units as described in [43] include the speed of light, which we set to
unity.

4
10
5
0
355
350
Longitude [deg.]
−10
−5
0
5
10
Latitude [deg.]
10
5
0
355
350
Longitude [deg.]
−10
−5
0
5
10
Latitude [deg.]
−0.00075
0.00075
vr
−1
5
δg
−0.01
0.01
δgvr
−5
5
−∆TkSZ/T
×10−7
FIG. 1: Example of maps used with the template method. All the maps are based on the simulation L1 m9 at redshift z = 0.6.
By zooming-in, we can observe the correlated features of the Doppler b map and the galaxy template. (Upper left) Galaxy
radial velocity. (Upper right) Galaxy density. (Center left) Doppler b template. (Center right) True Doppler b. (Lower left) 20
by 20 degree region of template map. (Lower right) 20 by 20 degree region of true Doppler b map. The vr, δg, and δgvr maps
have been smoothed with a Gaussian with a FWHM of 5 arcminutes for ease of visualization.
B.
Training set and feature selection
To generate simulated templates, we populate halos using
a halo occupation distribution (HOD) [59] following the pre-
scription of [60]. We calculate the probability of a halo of
mass Mh (defined such that the halo average density is 200
times the mean matter density) hosting a central galaxy and a
number of satellites with
⟨Ncen⟩(Mh) = fic
2 erfc
 log Mcut/Mh
√
2σ
!
,
(15)
⟨Nsat⟩(Mh) =
 Mh −κMcut
M1
!α
⟨Ncen⟩(Mh),
(16)
where erfc is the complement error function and the param-
eters of the HOD are defined in Table I. For each simulation

5
−11.4
−11.3
−11.2
−11.1
−11.0
−10.9
−10.8
log Cˆbb
ℓ[ℓ= 4000]
0.84
0.86
0.88
0.90
0.92
0.94
0.96
R(k) [k = 1 h/Mpc]
L1 m9
fgas+2σ
fgas−2σ
fgas−4σ
fgas−8σ
M*−σ
M*−σ+fgas−4σ
Planck
PlanckNu0p24Fix
PlanckNu0p48Fix
Jets
Jets fgas−4σ
LS8
LS8 fgas−8σ
FIG. 2: Variation in the matter power spectrum suppression at k = 1 h/Mpc as a function of the kSZ cross-correlation at
ℓ= 5000 and redshift z = 0.3. The template is formed of galaxies with stellar masses above 1011.3 M⊙. The dashed grey line is
the least-squares linear fit using the log-polynomial model.
TABLE I: Ranges of the HOD parameters used to generate
the templates in the training and test sets. The halo masses
are in units of M⊙/h.
Parameter
Meaning
Range
log Mcut
Mean halo mass with a central
[12.3, 13.4]
log M1
Mean halo mass with a satellite
[13.5, 14.6]
log σ
Transition in the power law
[−2.0, 0.0]
α
Slope of the power law
[0.5, 1.0]
κ
Minimum mass scaling to host a central [0.001, 3.0]
fic
Incompleteness parameter
[0.8, 1.0]
and redshift slice, we sample 100 sets of HOD parameters
from a Latin Hypercube. From our set of 14 feedback mod-
els and 22 redshift slices over 0.2 ≤z ≤1.25, this gives a
total of 30800 sample points. We display the samples for the
feedback model L1 m9 at redshift z = 0.6 in Fig. 3a. Each
HOD yields a cross-correlation Doppler b power spectrum
and galaxy density auto-spectrum. We bin the spectra in bins
10 ℓ-modes in width to reduce scatter. We then fit the binned
spectra with a log-polynomial model ( ˆCℓ) following
log ˆCX
ℓ=
3
X
n=0
aX
n
 log ℓn ,
(17)
where X ∈{gg, ˆbb}. The best-fit values are found by mini-
mizing the squared error between the polynomial model and
the observed spectra, such that
h
aX
n
i∗= argmin
aXn

ℓmax
X
ℓ=ℓmin
(2ℓ+ 1)∆ℓ
2

ˆCX
ℓ(aX
n ) −CX
ℓ
CX
ℓ

2,
(18)
where ∆ℓ= 10 is the bin width. The gg spectrum is fit us-
ing the modes 50 ≤ℓ≤6000 and the ˆbb spectrum is fit
on smaller scales using the range 1000 ≤ℓ≤6000. As
shown in Fig. 3, the log-polynomial fits agree to ∼1% for
the kSZ cross-spectrum. The galaxy auto-spectrum fits with
the same model agree to within ∼10%. It is worth noting that
the galaxies themselves provide only little information about
the shape of the power spectrum on very small scales, given
its shot noise (we refer the readers to Appendix B.) The co-
efficients aX
n compress the information in the power spectra
and capture changes in the baryonic feedback mechanisms.
They are highly correlated, have different ranges, and con-
found the impact of galaxy selection with variation in bary-
onic feedback. This can be seen in Fig. 3 where a collec-
tion of 100 galaxy templates (generated from different HOD
choices) gives 100 different cross-correlation spectra with the
same underlying matter power spectrum. In the lower panels
of Fig. 3, we compare the average cross-correlation spectra
of four feedback models. We can see that the shape of the
spectra correlates strongly with the shape of the matter power
spectrum ratio at a similar scale (where the angular scale can
be mapped to the wavenumber using the Limber approxima-
tion).
We add the redshift z as a feature to the set of parameters
{aX
n }. Our input vector for each gg and ˆbb realization com-
prises nine features (two cubic fits of four parameters each,

6
1000
2000
3000
4000
5000
6000
ℓ
10−6
10−5
10−4
ℓ(ℓ+ 1)Cˆbb
ℓ/2π
z = 0.6
Mean ⟨Cˆbb
ℓ⟩
Varying HOD
(a)
1000
2000
3000
4000
5000
6000
ℓ
10−5
ℓ(ℓ+ 1)⟨Cˆbb
ℓ⟩/2π
fgas + 2σ
L1 m9
fgas −4σ
Jets + fgas −4σ
10−1
100
k = ℓ/χ [h/Mpc]
(b)
10−1
100
k [h/Mpc]
0.80
0.85
0.90
0.95
1.00
R(k)
fgas + 2σ
L1 m9
fgas −4σ
Jets + fgas −4σ
102
103
104
ℓ= kχ
(c)
FIG. 3: (Top) Doppler b cross-correlation spectra from 100
HODs at redshift z = 0.6 for the fiducial feedback model
(L1 m9) along with the log-polynomial fits. (Center) Mean
Doppler b template cross-correlation power spectra. The
weaker AGN feedback denoted fgas+2σ is less suppressed
than the fiducial model and the more pronounced feedback
mechanisms (L1 m9, fgas−4σ Jets+fgas−4σ). The dashed
lines represent the mean of log-polynomial fits to the
cross-spectra. (Bottom) Power spectrum ratio at z = 6 for the
four models shown above. The dashed lines denote the mean
of the R(k) predictions from our emulator. In the two bottom
plots, the wavenumbers and angular multipoles are related
through the Limber approximation (see Eq. 11). All panels
are at redshift z = 0.6.
and the redshift). To summarize, for this work, a sample is an
individual realization of Cgg
ℓand C ˆbb
ℓgenerated from a given
simulation, at a single redshift, and with a set of unique HOD
parameters. We rescale the features to have a zero mean and
unit variance, and then perform a combination of principal
component analysis (PCA) and linear discriminant analysis
(LDA). LDA is commonly used for classification tasks [61]
because it creates features that are easier to distinguish from
one another. It uses labels for each of the inputs in the train-
ing set. This combination, known as discriminant analysis
of principal components, enables us to identify a subset of
features that are mutually uncorrelated but individually cor-
related with the shape of the power spectrum. We generate
labels by assigning an integer to each power spectrum fol-
lowing
Li = int
h
105 × mink{Ri(k)}
i
,
(19)
where i enumerates the different samples. This labeling strat-
egy groups together the power spectrum ratio with similar
amounts of suppression. The factor of 105 means the nu-
merical value of the suppression minimum is rounded to five
significant figures. Using a smaller value, such 103, leads to
fewer labels. After testing, we find that the LDA analysis
performs better with a larger set of labels. The labels Li are
used to compute the covariance matrix of the samples within
each class (in our case, a class is simply one choice of feed-
back model). Then, the new variables produced by LDA are
formed by a linear combination that maximizes the variance
between samples of different classes relative to the variance
within each class [62]. Thus, we use LDA to create a new
set of features (called the discriminant coordinates) that more
easily distinguish between simulations with a high level of
suppression and those with little baryonic feedback.
Following the creation of the discriminant coordinates, we
compute their principal components. The principal compo-
nents diagonalize the covariance matrix of the new variables
and are therefore statistically independent of each other. The
combination of LDA and PCA provides a mapping between
the measured coefficients an and the new features pn, which
are independent and more sensitive to the differences between
feedback models. We retain all available features, which we
label as pi
0, ..., pi
8 for each of the ith samples.
We also pre-process the target function, R(k). The method
developed by Ref. [55] works very well for our purposes. The
spectra are evaluated at 200 logarithmically-spaced points in
the range2 0.01 −8 Mpc−1 and smoothed with a Savitzky-
Golay filter with a width of 31 and a polynomial order of
3. Since the curves are smooth, the sample points are highly
correlated. We also use PCA decomposition on the smoothed
R(k) to reduce the network size and simplify the inference
procedure. We find that six components are sufficient to cap-
ture the variance in the shape of the matter power spectrum
between different baryonic feedback models.
2 The FLAMINGO matter power spectra are initially in inverse Mpc units.
We transition to h/Mpc following this step.

7
C.
Fitting and network architecture
While Fig. 2 illustrates the relationship between the power
spectrum suppression and the kSZ amplitude, it is worth not-
ing that this plot is only showing this correspondence for fixed
stellar mass cuts, wavenumber, redshift, and angular multi-
pole. When modeling the full matter power spectrum over
a wide range of scales, with different choices of HODs and
cosmic epochs, the patterns in the data become far more com-
plex. We find that linear regression models can work well in
limited cases, but do not generalize well in this context. For
this reason, we opt to leverage advances in machine learning
to achieve the desired model accuracy and flexibility.
For our model, we use a multi-layer perceptron (MLP).
MLPs are fully connected feed-forward neural networks that
can fit highly non-linear relationships. Our MLP comprises
four layers: an input layer with nine neurons, two hidden
layers of 1024 neurons each, and an output layer with six
neurons. This configuration was found after first using lin-
ear regression methods, followed by smaller networks. We
increased the number of neurons per layer to 2048 and found
no improvement in performance (with slight overfitting). The
workflow for the inference of the matter power spectrum sup-
pression from the galaxy and template power spectra is out-
lined in Fig. 4. We use a custom loss function based on the
mean absolute percent error loss function. We calculate it as
L(θ) =
1
Ntrain
Ntrain−1
X
i=0

Rtrue
i
−Rpred(θ; pi
0, ..., pi
8)
Rtrue
i

2
,
(20)
where Rpred denotes the MLP neural network prediction and
Rtrue is the true vector of R(k) evaluated at the sample points
in k. Note that while the network outputs the PCA coeffi-
cients, we define the loss in terms of the full R(k), as it is our
target for emulation.
We train the network using the ADAM optimizer, as im-
plemented in the TensorFlow library [63]. We use a batch
size of 8 and an initial learning rate of 10−3, which we reduce
progressively throughout the training, lasting 60 epochs. We
set a validation split of 5%. This means that 5% of the data
is used as validation during training and changes throughout
the optimization. The validation split provides an estimate of
the validation loss, which we compute after each step of the
optimization process. During this optimization, we save the
values of the weights and biases at the step where the valida-
tion loss is minimized. We present the validation results in
the next section.
D.
Model validation
We validate the model using three different methods. First,
we split our training set, leaving 5% for validation. 5% of
the samples are chosen at random across simulations and red-
shift slices. The residuals of this validation step are shown in
Fig. 5. The test set spans the full redshift range and is taken
from all feedback models. We recover the matter power spec-
trum suppression to near percent-level accuracy over the full
range of scales k ≤5 h/Mpc without bias. Next, we conduct a
cross-validation analysis. This step in the validation ensures
that the emulator is not over-fitting and remains sufficiently
flexible to account for diverse baryonic feedback models. The
results of the set of tests are shown in Fig. 6. For these tests,
we remove pairs of simulations entirely from the training set
and force the network trained on the remaining simulations
to extrapolate. We observe that the network maintains its ac-
curacy even when used in a feedback mechanism outside its
training set. In particular, we observe little to no bias when
changing the background cosmology by lowering the S 8 pa-
rameter or when changing the sum of the neutrino masses.
We observe some small biases when introducing variations
in supernova feedback and when increasing AGN feedback
to values that are very far (8σ) away from the fiducial gas-to-
halo mass relation. When extrapolating to smaller amounts of
feedback than what the model was trained on, we recover the
power spectrum with less than 1% bias. The single exception
is the most extreme Jets model, for which the error is close
to 5% on small scales. This model yields a power spectrum
shape unlike any other in the training set since collimated jets
induce a larger change in the distribution of baryons than the
thermal AGN model [54]. This is clearly visible in Fig. 2.
When extrapolating to the Jets model, while maintaining the
gas-to-halo mass relation closer to the observed values, we
find that our emulator extrapolates well and yields estimates
that are still within 1%. This validation test demonstrates the
robustness of our algorithm to changes in feedback models
and cosmology.
The network emulator is remarkably sta-
ble when introducing other sources of matter power spec-
trum suppression, such as an increase in the sum of neutrino
masses. This suggests that our approach could be used to dif-
ferentiate sources of suppression that arise from changes to
the linear matter power spectrum (such as warm dark matter)
from late-time, non-linear effects.
We proceed to a third round of validation by creating
more realistic galaxy catalogs beyond HODs. Given that the
FLAMINGO simulations are high-resolution hydrodynami-
cal simulations, we use the stellar mass information to gen-
erate catalogs with galaxy properties correlated with feed-
back. Instead of generating random parameters like the HOD,
we impose a completeness cut on the stellar mass of M∗≥
1011.3 M⊙for samples in the redshift range 0.45 < z < 0.85.
This mass cut and redshift range are meant to roughly repro-
duce the properties of the one-percent sample of the DESI
Luminous Red Galaxies, as described in [64]. We generate a
realization for each feedback model and redshift slice, result-
ing in a total of 308 samples. The error on the prediction of
our model for this alternate dataset is shown in Fig. 7. We ob-
serve a 0.5% bias in the median of the matter power spectrum
reconstruction, with errors reaching 3%. This effect is less
pronounced at higher redshifts and higher stellar masses. We
thus attribute the increased error to the correlation between
the stellar mass and feedback strength, which is not present
when selecting halos based on total mass. Given the HOD
parameterization (see Table I), the emulator training set does
not account for this correlation.
The galaxy auto-spectrum and the kSZ cross-spectrum
from the stellar mass cuts have a different shape than the
outputs of the HOD procedure. The predictive power of the

8
FIG. 4: Workflow (from left to right) of our MLP emulator taking as input the galaxy auto-spectrum, the kSZ cross-spectrum,
and the redshift. The full-size hidden layers with 1024 neurons are partially hidden for clarity. The numbers indicate the
shapes of the arrays after each operation.
10−1
100
k [h/Mpc]
−1.00
−0.75
−0.50
−0.25
0.00
0.25
0.50
0.75
1.00
R(k) Error [%]
FIG. 5: Test-set residuals from the neural network
prediction. The test amounts for 5% of the total dataset and
includes samples from all redshift slices and feedback
models. The solid line represents the median error over the
validation samples while the shaded area denotes the 68%
confidence interval. The error is calculated as
Rmodel(k)/Rtrue(k) −1.
network degrades outside its training set. Nevertheless, the
network still performs at the percent-level at k ≤0.8 h/Mpc
and at the 2%-level at k ≤5 h/Mpc. Crucially, the network
used for this test has only been exposed to HOD-generated
data in its training set. The choice of k ≤5 h/Mpc is mo-
tivated by the scale-cut imposed by the Dark Energy Sur-
vey [65] using the HMCode2020 calculation for the non-linear
power spectrum [66]. Our emulator matches the accuracy
of HMCode2020 (≈5% on this range of scales. This is true
even when extrapolating outside its training set, except for the
feedback models with fgas≤−4σ. This motivates the need to
expand the training set to include other subgrid models, al-
lowing for enhanced baryonic feedback. We leave the treat-
ment of other simulated datasets such as ANTILLES [42],
BAHAMAS [39], FABLE [67], Millenium TNG [68], and
SIMBA [69] to future work.
III.
RESULTS
To illustrate the potential uses of our algorithm, we cre-
ate a mock observation of Cgg
ℓ
and C ˆbb
ℓ. We take a typical
HOD from our validation set at redshift z = 0.6 with the fidu-
cial model (L1 m9) as our data points. Instead of fitting the
spectra using the cosmic variance limit errors, as we did in
Eq. (18), we compute realistic error bars accounting for par-
tial sky coverage and uncertainty in the kSZ measurement.
To estimate the covariance matrix of the cross-spectrum,
we create 750 Gaussian CMB realizations. For the primary
CMB, we use the Boltzmann code CAMB [70] and set the
parameters to fit the fiducial simulation’s cosmological pa-
rameters. We generate noise power spectra that are similar to
those for a Simons Observatory-like experiment [71]3
NCMB
ℓ
= s2
w exp

ℓ(ℓ+ 1)θ2
FWHM
8 ln 2

(21)
where the beam is θFWHM = 1.5 arcminutes and the white
noise level is set to sw = 5.0 µK-arcmin. We combine the
map of the primary CMB and its noise with the Doppler b
map (adjusting for units) to create Nsims = 750 mock sky
observations including CMB, noise, and kSZ. Note that we
use the same underlying Doppler b for all realizations. As
before, we cross-correlate the total map with the Doppler b
template. This provides a set of angular cross-spectra from
3 This is a rough choice of noise level; we do not attempt to be precise and
capture sources of noise such as the atmosphere and foreground residuals.

9
−8
−6
−4
−2
0
2
4
6
8
R(k) Error [%]
Jets
Jets fgas−4σ
fgas+2σ
L1 m9
LS8
LS8 fgas−8σ
10−1
100
k [h/Mpc]
−8
−6
−4
−2
0
2
4
6
8
R(k) Error [%]
fgas−8σ
LS8 fgas−8σ
10−1
100
k [h/Mpc]
PlanckNu0p24Fix
PlanckNu0p48Fix
10−1
100
k [h/Mpc]
M*−σ
M*−σ+fgas−4σ
FIG. 6: Set of cross-validation tests with restricted training sets. Each test is conducted by leaving two feedback models out of
the training set and using the removed simulations as the test set. The simulations listed in the legend were excluded during
training, and the error represents the difference between the true R(k) and the network’s extrapolation. The solid line
represents the median error over the validation samples, while the shaded area denotes the 68% confidence interval. The
uncertainty on the matter power spectrum in the range k ∼1 −10 h/Mpc from CMB and weak lensing [21] is of order
15-25%, meaning that the biases here represent ≪1σ in each case.
10−1
100
k [h/Mpc]
−2.5
−2.0
−1.5
−1.0
−0.5
0.0
0.5
1.0
1.5
2.0
2.5
R(k) Error [%]
M∗≥1011.3 M⊙, 0.45 ≤z ≤0.85
FIG. 7: Validation-set residuals from the neural network
prediction using a stellar mass cut rather than an HOD to
create a galaxy catalog. The solid line represents the median
error over the validation samples, while the shaded area
denotes the 68% confidence interval based on 308
realizations.
which we estimate the errors on the ˆbb measurement. The
covariance matrix we obtain from this set has negligible off-
diagonal terms, and its diagonal entries read
σ2(C
ˆbb
ℓ) =
1
Nz fsky
1
Nsims −1
X
i

C
ˆbb+noise, i
ℓ
−⟨C
ˆbb+noise
ℓ
⟩
2
,
(22)
where C ˆbb+noise
ℓ
is the cross-spectrum of the template with
the map including the non-kSZ contributions, fsky is the joint
fraction of the sky covered by the galaxy and CMB surveys.
We take fsky = 0.2 to match the DESI footprint overlap with
SO, assuming an overlap of 10000 deg2, following [72]. This
matches the redshift overlap of the first two redshift bins of
the DESI LRG samples. Given the high noise level, we re-bin
the cross-spectra to use 20 linearly-spaced bins in the range
ℓ∈[1000, 6000]. The cross-spectrum used in our forecast
and its error bars are shown in Fig. 8. For the galaxy auto-
spectrum, we find that the relative uncertainty on Cgg
ℓis orders
of magnitude smaller than the uncertainty on C ˆbb
ℓ. Because of
this limited contribution, we fix the galaxy spectrum parame-
ters agg
n in our forecast. We do the same with the redshift of
the survey and vary only aˆbb
n .
From the error bars calculated in Eq. (22), we construct a
Gaussian likelihood for the parameters aˆbb
n defined in Eq. (17)

10
1000
2000
3000
4000
5000
6000
ℓ
0
1
2
3
4
5
6
105 × ℓ(ℓ+ 1)Cˆbb
ℓ/2π
Cubic Polynomial Model
Simulated Observations
FIG. 8: Simulated observations of a kSZ cross-spectrum
with error bars from the primary CMB and its noise. The
green line denotes the log-space cubic model of Eq. (17)
used to compress the data. The detection significance of the
kSZ signal for this simulated measurement is ≈50σ.
10−1
100
k [h/Mpc]
0.80
0.85
0.90
0.95
1.00
R(k)
L1 m9 (True)
fgas+2σ
fgas−2σ
fgas−4σ
fgas−8σ
FIG. 9: Inferred matter power spectrum ratio from the
simulated observations of Fig. 8 at z = 0.6. The light (dark)
shaded area corresponds to the 68% (95%) confidence
interval propagated from the error margins in the kSZ
cross-spectrum using MCMC sampling. This represents
measurement error and should not be confused with the
emulator error shown previously. The dashed lines represent
the true suppression for different feedback models.
which reads
ln L(a
ˆbb
n ) ∝−1
2
X
ℓ
h ˆC ˆbb
ℓ(aˆbb
n ) −C ˆbb
ℓ
i2
σ2(C ˆbb
ℓ)
,
(23)
We use Markov chain Monte Carlo (MCMC) sampling to
compute the distribution of the parameters given the simu-
lated observations of C ˆbb
ℓ. We use the emcee package [73]
to sample the likelihood, employing eight walkers to gener-
ate 200,000 samples each (with a burn-in of 40,000). We test
convergence by ensuring that the chains are over 50 autocor-
relation lengths. To avoid unphysical models, we impose a
uniform prior on the factors pn and reject the samples out-
side a given range. The upper and lower limits are found
by the bounds on these parameters in the training set. Since
the pn values are independent, the priors for each parame-
ter can be applied individually (without a need to account
for correlations as would be the case if we used the prior
on the an). We perform the transformations for each sam-
ple listed in Sec. II B. We then feed the remapped parameters
into our emulator to obtain samples of the matter power spec-
trum suppression. This step is remarkably fast, as our em-
ulator processes over 106 samples in under 30 seconds dur-
ing an interactive Python session. In Fig. 8, we show the
68% confidence interval and mean of the samples. The sig-
nal to noise ratio of this mock measurement can be calculated
using SNR =
q
χ2
bf −χ2
null, where −1
2χ2 is the quantity on
the right hand side of Eq. (23), χ2
bf denotes the best-fitting
model, and χ2
null is the null hypothesis with kSZ signal be-
ing zero on all scales. The signal-to-noise for the data points
in Fig. 8 is ∼50σ.
This matches closely the predictions
of [47] when considering measurements over the redshift in-
terval 0.4 ≤z ≤0.8. In Fig. 9, we also display the poste-
rior distribution on the matter power spectrum suppression.
We can see that the kSZ signal allows us to discriminate be-
tween the fiducial model and the stronger feedback models
(fgas−4σ, fgas−8σ) that fall outside of the 68% confidence
interval.
IV.
DISCUSSION
We present the first power spectrum suppression emulator
based on kSZ observables. We utilize the diverse set of sim-
ulations from the FLAMINGO suite and create over 30,000
mock galaxy clustering and template kSZ measurements. We
generate the templates by populating dark matter halos fol-
lowing a halo occupation distribution method. We consider
14 feedback models in the redshift range 0.2 ≤z ≤1.25 in
bins of width ∆z = 0.05. We then train a multi-layer percep-
tron to predict the scale-dependent suppression of the mat-
ter power spectrum from baryonic feedback from these sim-
ulated datasets using a custom loss function. What sets this
work apart from the emulators in the literature is that its in-
put is directly observable. Following a similar data-driven
approach, an MLP algorithm has recently been developed to
constrain the epoch of reionization directly from kSZ using
maps rather than angular power spectra [74].
We develop a new approach to condense the information in
the kSZ cross-correlation and galaxy number density angular
power spectra through a combination of linear discriminant
analysis and principal component analysis. We validate the
model thoroughly in three steps. First, we remove pairs of
similar feedback models from the training set and evaluate the
model’s performance when extrapolating to unseen data. Our
model retains its accuracy for the vast majority of feedback
implementations, except for the most extreme feedback sim-
ulations. Second, we generate catalogs based on a halo stel-
lar mass threshold and evaluate the model when faced with

11
galaxy catalogs not generated by an HOD. Finally, we ensure
the model extracts the information mainly from the template
kSZ and not from the redshift or galaxy density angular power
spectrum. We confirm that the best predictor of the suppres-
sion of the matter power spectrum is the shape of the kSZ
template angular power spectrum.
Ongoing and future surveys, such as DESI [14], Eu-
clid [75], Roman [76], SPHEREx [77] and the Rubin Obser-
vatory’s LSST [78], will produce high-resolution templates
for extracting the kSZ signal. When combined with low-noise
observations of the CMB by experiments such as Simons Ob-
servatory [72] and SPT-3G [79], we expect the total signal-to-
noise ratio to exceed 100σ, a factor of 10 improvement over
existing studies. Our neural network allows for high-speed
computations of the baryonic corrections to the matter power
spectrum (with millisecond runtime). It could easily be inte-
grated into gravitational lensing pipelines for joint fitting of
the kSZ cross-spectrum and galaxy lensing. It could also be
extended beyond the redshift range 0.2 ≤z ≤1.25 considered
here, using the same training procedure as described above.
Currently, kSZ information is included through the electron
density profile in a discrete set of simulations. While this es-
tablishes an informative baseline, our approach allows for in-
terpolation between feedback models and direct MCMC sam-
pling. This work presents the first step in jointly fitting the
kSZ effect and the clustering of galaxies and matter. It opens
a new observational window that will allow us to isolate the
causes of the statistical anomalies in weak gravitational lens-
ing.
It will help identify valid baryonic feedback models
and potentially isolate hidden signatures of exotic dark matter
candidates. While it generalizes very well to many cosmolo-
gies beyond its training set, some validation tests show that
this emulator approach would benefit from training on a more
diverse set of subgrid models. In future work, we will cali-
brate with a broader set of hydrodynamical simulations and
release the inference framework for use by the community.
ACKNOWLEDGMENTS
MM acknowledges support from NSF grants AST-
2307727 and AST-2153201. MM and AL acknowledge sup-
port from NASA grant 21-ATP21-0145. KMS was supported
by an NSERC Discovery Grant, by the Daniel Family Foun-
dation, and by the Centre for the Universe at Perimeter In-
stitute. Research at Perimeter Institute is supported by the
Government of Canada through Industry Canada and by the
Province of Ontario through the Ministry of Research & In-
novation. XC acknowledges support from the U.S. Depart-
ment of Energy. This work used the DiRAC@Durham facil-
ity managed by the Institute for Computational Cosmology
on behalf of the STFC DiRAC HPC Facility (www.dirac.
ac.uk). The equipment was funded by BEIS capital fund-
ing via STFC capital grants ST/K00042X/1, ST/P002293/1,
ST/R002371/1 and ST/S002502/1, Durham University and
STFC operations grant ST/R000832/1. DiRAC is part of the
National e-Infrastructure.
DATA AVAILABILITY
The angular power spectra of the galaxies and templates
generated through this work are available upon request.
[1] Planck Collaboration, N. Aghanim, Y. Akrami, M. Ashdown,
J. Aumont, C. Baccigalupi, M. Ballardini, A. J. Banday, R. B.
Barreiro, N. Bartolo, et al., A&A 641, A6 (2020), 1807.06209.
[2] E. Rosenberg, S. Gratton, and G. Efstathiou, MNRAS 517,
4620 (2022), 2205.10869.
[3] E. Camphuis, W. Quan, L. Balkenhol, A. R. Khalife, F. Ge,
F. Guidi, N. Huang, G. P. Lynch, Y. Omori, C. Trendafilova,
et al., arXiv e-prints arXiv:2506.20707 (2025), 2506.20707.
[4] T. Louis, A. La Posta, Z. Atkins, H. T. Jense, I. Abril-Cabezas,
G. E. Addison, P. A. R. Ade, S. Aiola, T. Alford, D. Alonso,
et al., arXiv e-prints arXiv:2503.14452 (2025), 2503.14452.
[5] Planck Collaboration, N. Aghanim, Y. Akrami, M. Ashdown,
J. Aumont, C. Baccigalupi, M. Ballardini, A. J. Banday, R. B.
Barreiro, N. Bartolo, et al., A&A 641, A8 (2020), 1807.06210.
[6] J. Carron, M. Mirmelstein, and A. Lewis, JCAP 2022, 039
(2022), 2206.07773.
[7] Z. Pan, F. Bianchini, W. L. K. Wu, P. A. R. Ade, Z. Ahmed,
E. Anderes, A. J. Anderson, B. Ansarinejad, M. Archipley,
K. Aylor, et al., Phys. Rev. D 108, 122005 (2023), 2308.11608.
[8] F. Ge, M. Millea, E. Camphuis, C. Daley, N. Huang, Y. Omori,
W. Quan, E. Anderes, A. J. Anderson, B. Ansarinejad, et al.,
Phys. Rev. D 111, 083534 (2025), 2411.06000.
[9] M. S. Madhavacheril, F. J. Qu, B. D. Sherwin, N. MacCrann,
Y. Li, I. Abril-Cabezas, P. A. R. Ade, S. Aiola, T. Alford,
M. Amiri, et al., ApJ 962, 113 (2024), 2304.05203.
[10] F. J. Qu, B. D. Sherwin, M. S. Madhavacheril, D. Han, K. T.
Crowley, I. Abril-Cabezas, P. A. R. Ade, S. Aiola, T. Alford,
M. Amiri, et al., ApJ 962, 112 (2024), 2304.05202.
[11] F. J. Qu, F. Ge, W. L. Kimmy Wu, I. Abril-Cabezas,
M. S. Madhavacheril, M. Millea, E. Anderes, A. J. An-
derson, B. Ansarinejad, M. Archipley, et al., arXiv e-prints
arXiv:2504.20038 (2025), 2504.20038.
[12] M. S. Madhavacheril,
Philosophical Transactions of the
Royal Society of London Series A 383, 20240025 (2025),
2411.08152.
[13] A. G. Riess, W. Yuan, L. M. Macri, D. Scolnic, D. Brout,
S. Casertano, D. O. Jones, Y. Murakami, G. S. Anand,
L. Breuval, et al., ApJL 934, L7 (2022), 2112.04510.
[14] M. Abdul Karim, J. Aguilar, S. Ahlen, S. Alam, L. Allen, C. A.
Prieto, O. Alves, A. Anand, U. Andrade, E. Armengaud, et al.,
Phys. Rev. D 112, 083515 (2025), 2503.14738.
[15] T. M. C. Abbott, M. Aguena, A. Alarcon, S. Allam, O. Alves,
A. Amon, F. Andrade-Oliveira, J. Annis, S. Avila, D. Bacon,
et al., Phys. Rev. D 105, 023520 (2022), 2105.13549.
[16] X. Li, T. Zhang, S. Sugiyama, R. Dalal, R. Terasawa, M. M.
Rau, R. Mandelbaum, M. Takada, S. More, M. A. Strauss,
et al., Phys. Rev. D 108, 123518 (2023), 2304.00702.
[17] R. Dalal, X. Li, A. Nicola, J. Zuntz, M. A. Strauss,
S. Sugiyama, T. Zhang, M. M. Rau, R. Mandelbaum,
M. Takada, et al., Phys. Rev. D
108, 123519 (2023),
2304.00701.
[18] A. H. Wright, B. St¨olzner, M. Asgari, M. Bilicki, B. Gib-
lin, C. Heymans, H. Hildebrandt, H. Hoekstra, B. Joachimi,
K. Kuijken, et al., arXiv e-prints arXiv:2503.19441 (2025),

12
2503.19441.
[19] A. Amon and G. Efstathiou, MNRAS 516, 5355 (2022),
2206.11794.
[20] C. Preston, A. Amon, and G. Efstathiou, MNRAS 533, 621
(2024), 2404.18240.
[21] K. Perez Sarmiento,
A. Lagu¨e,
M. S. Madhavacheril,
B. Jain, and B. Sherwin, Phys. Rev. D 112, 063510 (2025),
2502.06687.
[22] C. Doux and T. Karwal, arXiv e-prints arXiv:2506.16434
(2025), 2506.16434.
[23] R. Terasawa, X. Li, M. Takada, T. Nishimichi, S. Tanaka,
S. Sugiyama, T. Kurita, T. Zhang, M. Shirasaki, R. Takahashi,
et al., Phys. Rev. D 111, 063509 (2025), 2403.20323.
[24] H. Tanimura, S. Zaroubi, and N. Aghanim, A&A 645, A112
(2021), 2007.02952.
[25] E. Schaan, S. Ferraro, M. Vargas-Maga˜na, K. M. Smith, S. Ho,
S. Aiola, N. Battaglia, J. R. Bond, F. De Bernardis, E. Cal-
abrese, et al., Phys. Rev. D 93, 082002 (2016), 1510.06442.
[26] S. Raghunathan, P. A. R. Ade, A. J. Anderson, B. Ansarine-
jad, M. Archipley, J. E. Austermann, L. Balkenhol, J. A. Beall,
K. Benabed, A. N. Bender, et al., Phys. Rev. Lett. 133, 121004
(2024), 2403.02337.
[27] E. Schaan, S. Ferraro, S. Amodeo, N. Battaglia, S. Aiola, J. E.
Austermann, J. A. Beall, R. Bean, D. T. Becker, R. J. Bond,
et al., Phys. Rev. D 103, 063513 (2021), 2009.05557.
[28] B. Hadzhiyska, S. Ferraro, B. Ried Guachalla, E. Schaan,
J. Aguilar, S. Ahlen, N. Battaglia, J. R. Bond, D. Brooks,
E. Calabrese, et al., Phys. Rev. D 112, 083509 (2025),
2407.07152.
[29] B. Ried Guachalla, E. Schaan, B. Hadzhiyska, and S. Ferraro,
Phys. Rev. D 109, 103533 (2024), 2312.12435.
[30] L. Bigwood, A. Amon, A. Schneider, J. Salcido, I. G. Mc-
Carthy, C. Preston, D. Sanchez, D. Sijacki, E. Schaan, S. Fer-
raro, et al., MNRAS 534, 655 (2024), 2404.06098.
[31] A. Schneider, S. K. Giri, S. Amodeo, and A. Refregier, MN-
RAS 514, 3802 (2022), 2110.02228.
[32] C. Preston, A. Amon, and G. Efstathiou, MNRAS 525, 5554
(2023), 2305.09827.
[33] N. Dalal, C.-H. To, C. Hirata, T. Hyeon-Shin, M. Hilton,
S. Pandey, and J. R. Bond, arXiv e-prints arXiv:2507.04476
(2025), 2507.04476.
[34] M. Kovaˇc, A. Nicola, J. Bucko, A. Schneider, R. Reischke,
S. K. Giri, R. Teyssier, M. Schaller, and J. Schaye, JCAP 2025,
046 (2025), 2507.07991.
[35] R. Reischke and S. Hagstotz, arXiv e-prints arXiv:2507.17742
(2025), 2507.17742.
[36] L. Bigwood, M. Yamamoto, J. Siegel, A. Amon, I. G. Mc-
Carthy, R. Dave, J. Salcido, M. Schaller, J. Schaye, and
T. Yang, arXiv e-prints arXiv:2510.15822 (2025), 2510.15822.
[37] I. G. McCarthy, A. Amon, J. Schaye, E. Schaan, R. E. Angulo,
J. Salcido, M. Schaller, L. Bigwood, W. Elbers, R. Kugel, et al.,
MNRAS 540, 143 (2025), 2410.19905.
[38] M. P. van Daalen, J. Schaye, C. M. Booth, and C. Dalla Vec-
chia, MNRAS 415, 3649 (2011), 1104.1174.
[39] I. G. McCarthy, J. Schaye, S. Bird, and A. M. C. Le Brun,
MNRAS 465, 2936 (2017), 1603.02702.
[40] N. A. Henden, E. Puchwein, S. Shen, and D. Sijacki, MNRAS
479, 5385 (2018), 1804.05064.
[41] M. P. van Daalen, I. G. McCarthy, and J. Schaye, MNRAS
491, 2424 (2020), 1906.00968.
[42] J. Salcido, I. G. McCarthy, J. Kwan, A. Upadhye, and A. S.
Font, MNRAS 523, 2247 (2023), 2305.09710.
[43] J. Schaye, R. Kugel, M. Schaller, J. C. Helly, J. Braspen-
ning, W. Elbers, I. G. McCarthy, M. P. van Daalen, B. Van-
denbroucke, C. S. Frenk, et al., MNRAS 526, 4978 (2023),
2306.04024.
[44] J. Siegel, A. Amon, I. G. McCarthy, L. Bigwood, M. Ya-
mamoto, E. Bulbul, J. E. Greene, J. McCullough, M. Schaller,
and J. Schaye,
arXiv e-prints arXiv:2509.10455 (2025),
2509.10455.
[45] E. Bulbul, A. Liu, M. Kluge, X. Zhang, J. S. Sanders, Y. E.
Bahar, V. Ghirardini, E. Artis, R. Seppi, C. Garrel, et al., A&A
685, A106 (2024), 2402.08452.
[46] P. Popesso, A. Biviano, I. Marini, K. Dolag, S. Vladutescu-
Zopp, B. Csizi, V. Biffi, G. Lamer, A. Robothan, M. Bravo,
et al., arXiv e-prints arXiv:2411.16555 (2024), 2411.16555.
[47] K. M. Smith,
M. S. Madhavacheril,
M. M¨unchmeyer,
S. Ferraro, U. Giri, and M. C. Johnson, arXiv e-prints
arXiv:1810.13423 (2018), 1810.13423.
[48] S.
Ho,
S.
Dedeo,
and
D.
Spergel,
arXiv
e-prints
arXiv:0903.2845 (2009), 0903.2845.
[49] J. Shao, P. Zhang, W. Lin, Y. Jing, and J. Pan, MNRAS 413,
628 (2011), 1004.1301.
[50] A. Wayland, D. Alonso, and A. La Posta, arXiv e-prints
arXiv:2509.18732 (2025), 2509.18732.
[51] S. Foreman, S. C. Hotinli, M. S. Madhavacheril, A. van En-
gelen, and C. D. Kreisch, Phys. Rev. D 107, 083502 (2023),
2209.03973.
[52] K. K. Rogers and H. V. Peiris, Phys. Rev. D 103, 043526
(2021), 2007.13751.
[53] A. Mootoovaloo, A. H. Jaffe, A. F. Heavens, and F. Leclercq,
Astronomy and Computing 38, 100508 (2022), 2105.02256.
[54] M. Schaller, J. Schaye, R. Kugel, J. C. Broxterman, and M. P.
van Daalen, MNRAS 539, 1337 (2025), 2410.17109.
[55] G. Aric`o, R. E. Angulo, S. Contreras, L. Ondaro-Mallea,
M. Pellejero-Iba˜nez, and M. Zennaro, MNRAS 506, 4070
(2021), 2011.15018.
[56] R. Kugel, J. Schaye, M. Schaller, J. C. Helly, J. Braspenning,
W. Elbers, C. S. Frenk, I. G. McCarthy, J. Kwan, J. Salcido,
et al., MNRAS 526, 6103 (2023), 2306.05492.
[57] E. Semboloni, H. Hoekstra, J. Schaye, M. P. van Daalen, and
I. G. McCarthy, MNRAS 417, 2020 (2011), 1105.1075.
[58] E. Semboloni, H. Hoekstra, and J. Schaye, MNRAS 434, 148
(2013), 1210.7303.
[59] Z. Zheng, A. L. Coil, and I. Zehavi, ApJ 667, 760 (2007),
astro-ph/0703457.
[60] S. Yuan, L. H. Garrison, D. J. Eisenstein, and R. H. Wechsler,
MNRAS 515, 871 (2022), 2203.11963.
[61] A. Martinez and A. Kak, IEEE Transactions on Pattern Analy-
sis and Machine Intelligence 23, 228 (2001).
[62] T. Hastie, R. Tibshirani, and J. Friedman, The Elements of Sta-
tistical Learning (Springer, 2009), ISBN 978-0-387-84857-0,
978-0-387-84858-7.
[63] M. Abadi, A. Agarwal, P. Barham, E. Brevdo, Z. Chen,
C. Citro, G. S. Corrado, A. Davis, J. Dean, M. Devin, et al.,
arXiv e-prints arXiv:1603.04467 (2016), 1603.04467.
[64] F. Prada, J. Ereza, A. Smith, J. Lasker, R. Vaisakh, R. Kehoe,
C. A. Dong-P´aez, M. Siudek, M. S. Wang, S. Alam, et al.,
A&A 698, A170 (2025), 2306.06315.
[65] C. Doux, B. Jain, D. Zeurcher, J. Lee, X. Fang, R. Rosenfeld,
A. Amon, H. Camacho, A. Choi, L. F. Secco, et al., MNRAS
515, 1942 (2022), 2203.07128.
[66] A. J. Mead, S. Brieden, T. Tr¨oster, and C. Heymans, MNRAS
502, 1401 (2021), 2009.01858.
[67] N. A. Henden, E. Puchwein, S. Shen, and D. Sijacki, MNRAS
479, 5385 (2018), 1804.05064.
[68] R. Pakmor, V. Springel, J. P. Coles, T. Guillet, C. Pfrommer,
S. Bose, M. Barrera, A. M. Delgado, F. Ferlito, C. Frenk, et al.,
MNRAS 524, 2539 (2023), 2210.10060.

13
[69] R. Dav´e, D. Angl´es-Alc´azar, D. Narayanan, Q. Li, M. H.
Rafieferantsoa, and S. Appleby, MNRAS 486, 2827 (2019),
1901.10203.
[70] A. Lewis and A. Challinor, CAMB: Code for Anisotropies in
the Microwave Background, Astrophysics Source Code Li-
brary, record ascl:1102.026 (2011), 1102.026.
[71] P. Ade, J. Aguirre, Z. Ahmed, S. Aiola, A. Ali, D. Alonso,
M. A. Alvarez, K. Arnold, P. Ashton, J. Austermann, et al.,
JCAP 2019, 056 (2019), 1808.07445.
[72] M. Abitbol, I. Abril-Cabezas, S. Adachi, P. Ade, A. E. Adler,
P. Agrawal, J. Aguirre, Z. Ahmed, S. Aiola, T. Alford, et al.,
JCAP 2025, 034 (2025), 2503.00636.
[73] D. Foreman-Mackey, D. W. Hogg, D. Lang, and J. Goodman,
PASP 125, 306 (2013), 1202.3665.
[74] F. Farhadi Khouzani, A. K. Shaw, P. La Plante, B. Mustafa Sha-
reef, and L. Gewali, arXiv e-prints arXiv:2511.04770 (2025),
2511.04770.
[75] Euclid Collaboration, R. Scaramella, J. Amiaux, Y. Mel-
lier, C. Burigana, C. S. Carvalho, J.-C. Cuillandre, A. Da
Silva, A. Derosa, J. Dinis, et al., A&A 662, A112 (2022),
2108.01201.
[76] D. Spergel, N. Gehrels, C. Baltay, D. Bennett, J. Breckinridge,
M. Donahue, A. Dressler, B. S. Gaudi, T. Greene, O. Guyon,
et al., arXiv e-prints arXiv:1503.03757 (2015), 1503.03757.
[77] O. Dor´e, J. Bock, M. Ashby, P. Capak, A. Cooray, R. de Putter,
T. Eifler, N. Flagey, Y. Gong, S. Habib, et al., arXiv e-prints
arXiv:1412.4872 (2014), 1412.4872.
[78] L. P. Guy, K. Bechtol, E. Bellm, B. Blum, M. L. Graham,
ˇZ. Ivezi´c, R. Lupton, P. Marshall, C. T. Slater, M. Strauss, et al.,
Rubin observatory plans for an early science program (2024).
[79] L. Balkenhol, D. Dutcher, A. Spurio Mancini, A. Dous-
sot, K. Benabed, S. Galli, P. A. R. Ade, A. J. Anderson,
B. Ansarinejad, M. Archipley, et al., Phys. Rev. D 108, 023510
(2023), 2212.05642.
[80] N. Padmanabhan, X. Xu, D. J. Eisenstein, R. Scalzo, A. J.
Cuesta, K. T. Mehta, and E. Kazin, MNRAS 427, 2132 (2012),
1202.0090.
Appendix A: Imperfect velocity reconstruction
Throughout this work, we have assumed that the galaxy
velocities were known. In practice, however, the galaxy ve-
locities are estimated by solving the continuity equation [80].
The resulting estimated radial velocity field (which we will
denote ˆvr) is strongly correlated with the true velocity field
on large scales. Taking the large-scale limit, we can approxi-
mate
Pˆvrvr(k, µ, z) ≈r2
vPvrvr(k, µ, z),
k ≪1.
(A1)
where r2
v is a constant capturing the correlation between the
reconstructed and true velocities. It can be estimated for any
given galaxy survey using simulations.
Appendix B: Training with limited information
In this appendix, we test the capacity of the emulator ap-
proach to infer the shape of the matter power spectrum with-
out being given the full galaxy angular power spectrum. Most
of the small-scale matter power spectrum information is con-
tained in the Doppler b cross-spectrum. In Fig. 10, we test the
10−1
100
k [h/Mpc]
−1.00
−0.75
−0.50
−0.25
0.00
0.25
0.50
0.75
1.00
R(k) Error [%]
(a)
10−1
100
k [h/Mpc]
−1.00
−0.75
−0.50
−0.25
0.00
0.25
0.50
0.75
1.00
R(k) Error [%]
(b)
10−1
100
k [h/Mpc]
−5
−4
−3
−2
−1
0
1
2
3
4
5
R(k) Error [%]
(c)
FIG. 10: (Top) Test set validation after training the emulator
without any of the agg
n parameters. (Center) Test set
validation after training the emulator with only agg
0 for the
agg
n parameters. (Bottom) Test set validation after training the
emulator without any of the aˆbb
n parameters. The range in the
bottom panel was extended to capture the full range of
deviations.

14
network’s performance without the galaxy power spectrum
observations. We use the same technique as previously, re-
taining 5% of the data as a validation set. In the first case, we
remove the four parameters used to fit Cgg
ℓ, and in the second
case, we keep the constant parameter of the fit. This constant
acts as a proxy for the number density as it is proportional to
the galaxy shot noise.
We observe a degradation in network performance com-
pared to the case with all nine features, as shown in Fig. 5.
Including the shot noise does not visually change the quality
of the fit, but it slightly improves the mean absolute error of
the prediction on the test set. While most of the neural net-
work predictions remain within 1%, we observe a significant
number of catastrophic failures, which are absent when in-
cluding the information from the full galaxy auto-spectrum
(see Fig. 5).
As predicted, the neural network fails when
trained only using the galaxy auto-spectrum and the redshift.
This demonstrates that the network does not learn the shape
of the matter power spectrum from the galaxies themselves,
but from the small-scale information contained in Doppler b
maps. This test ensures that our network does not over-fit the
galaxy spectrum and that there is no information leakage in
our pipeline.
We conclude from this test that the galaxy auto-spectrum
contains valuable information, making the emulator more
adaptable to different galaxy populations. Adding other ob-
servables, such as gravitational lensing, thermal Sunyaev-
Zeldovich, or X-ray, to the input vector could also contribute
to the accuracy of the emulator. Given our pre-processing
steps, our training process is easily adaptable to higher-
dimensional data.
